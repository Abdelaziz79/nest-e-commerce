{
  "info": {
    "_postman_id": "23debd09-5163-4510-944d-81a0f45167b5",
    "name": "NestJS E-Commerce API - Complete Collection",
    "description": "Complete test collection for NestJS GraphQL application with Auth (OTP-based), Users, Storage, OAuth, and Admin features",
    "schema": "https://schema.getpostman.com/json/collection/v2.1.0/collection.json",
    "_exporter_id": "33369626"
  },
  "item": [
    {
      "name": "üîê Auth - Registration & Verification",
      "item": [
        {
          "name": "1. Register User (Sends OTP)",
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "var jsonData = pm.response.json();",
                  "",
                  "if (jsonData.data && jsonData.data.register) {",
                  "    var response = jsonData.data.register;",
                  "    ",
                  "    pm.environment.set('testEmail', response.email);",
                  "    console.log('‚úì Registration successful');",
                  "    console.log('‚úì Email stored:', response.email);",
                  "    console.log('‚ö†Ô∏è  Check your email for OTP code');",
                  "    ",
                  "    pm.test('Registration successful', function() {",
                  "        pm.expect(response.success).to.eql(true);",
                  "        pm.expect(response.email).to.be.a('string');",
                  "        pm.expect(response.message).to.include('Check your email');",
                  "    });",
                  "} else if (jsonData.errors) {",
                  "    console.error('‚ùå GraphQL errors:', jsonData.errors);",
                  "    pm.test('No GraphQL errors', function() {",
                  "        pm.expect(jsonData.errors).to.be.undefined;",
                  "    });",
                  "}"
                ],
                "type": "text/javascript",
                "packages": {},
                "requests": {}
              }
            },
            {
              "listen": "prerequest",
              "script": {
                "exec": [
                  "// Generate random email for testing",
                  "const random = Math.floor(Math.random() * 100000);",
                  "pm.environment.set('testEmail', `test${random}@example.com`);",
                  "console.log('Generated test email:', pm.environment.get('testEmail'));",
                  ""
                ],
                "type": "text/javascript",
                "packages": {},
                "requests": {}
              }
            }
          ],
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "body": {
              "mode": "graphql",
              "graphql": {
                "query": "mutation Register($input: RegisterInput!) {\n  register(input: $input) {\n    success\n    message\n    email\n  }\n}",
                "variables": "{\n  \"input\": {\n    \"firstName\": \"John\",\n    \"lastName\": \"Doe\",\n    \"email\": \"{{testEmail}}\",\n    \"password\": \"{{testPassword}}\"\n  }\n}"
              }
            },
            "url": {
              "raw": "{{graphqlEndpoint}}",
              "host": ["{{graphqlEndpoint}}"]
            },
            "description": "Step 1: Register a new user. This sends a welcome email with OTP verification code. Generates a random email to avoid duplicates."
          },
          "response": []
        },
        {
          "name": "2. Verify Email with OTP",
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "var jsonData = pm.response.json();",
                  "",
                  "if (jsonData.data && jsonData.data.verifyEmail) {",
                  "    var response = jsonData.data.verifyEmail;",
                  "    var accessToken = response.accessToken;",
                  "    var refreshToken = response.refreshToken;",
                  "    var userId = response.user.id;",
                  "    ",
                  "    pm.environment.set('token', accessToken);",
                  "    pm.environment.set('refreshToken', refreshToken);",
                  "    pm.environment.set('userId', userId);",
                  "    ",
                  "    console.log('‚úì Email verified successfully');",
                  "    console.log('‚úì Access token stored');",
                  "    console.log('‚úì Refresh token stored');",
                  "    console.log('‚úì User ID stored:', userId);",
                  "    ",
                  "    pm.test('Email verification successful', function() {",
                  "        pm.expect(accessToken).to.be.a('string').and.to.have.lengthOf.at.least(50);",
                  "        pm.expect(refreshToken).to.be.a('string').and.to.have.lengthOf.at.least(50);",
                  "        pm.expect(userId).to.be.a('string');",
                  "        pm.expect(response.user.email).to.eql(pm.environment.get('testEmail'));",
                  "        pm.expect(response.user.role).to.eql('customer');",
                  "    });",
                  "} else if (jsonData.errors) {",
                  "    console.error('‚ùå GraphQL errors:', jsonData.errors);",
                  "    pm.test('No GraphQL errors', function() {",
                  "        pm.expect(jsonData.errors).to.be.undefined;",
                  "    });",
                  "}"
                ],
                "type": "text/javascript",
                "packages": {},
                "requests": {}
              }
            }
          ],
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "body": {
              "mode": "graphql",
              "graphql": {
                "query": "mutation VerifyEmail($input: VerifyEmailInput!) {\n  verifyEmail(input: $input) {\n    accessToken\n    refreshToken\n    user {\n      id\n      email\n      firstName\n      lastName\n      role\n    }\n  }\n}",
                "variables": "{\n  \"input\": {\n    \"email\": \"{{testEmail}}\",\n    \"otpCode\": \"{{otpCode}}\"\n  }\n}"
              }
            },
            "url": {
              "raw": "{{graphqlEndpoint}}",
              "host": ["{{graphqlEndpoint}}"]
            },
            "description": "Step 2: Verify email with OTP code received via email. Replace '123456' with actual OTP from your email or environment variable."
          },
          "response": []
        },
        {
          "name": "3. Resend OTP (Email Verification)",
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "var jsonData = pm.response.json();",
                  "",
                  "if (jsonData.data && jsonData.data.resendOtp === true) {",
                  "    console.log('‚úì OTP resent successfully');",
                  "    pm.test('OTP resent', function() {",
                  "        pm.expect(jsonData.data.resendOtp).to.be.true;",
                  "    });",
                  "} else if (jsonData.errors) {",
                  "    console.error('‚ùå GraphQL errors:', jsonData.errors);",
                  "    var errorMessage = jsonData.errors[0].message;",
                  "    pm.test('Rate limit handling', function() {",
                  "        pm.expect(errorMessage).to.include('wait');",
                  "    });",
                  "}"
                ],
                "type": "text/javascript",
                "packages": {},
                "requests": {}
              }
            }
          ],
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "body": {
              "mode": "graphql",
              "graphql": {
                "query": "mutation ResendOtp($input: ResendOtpInput!) {\n  resendOtp(input: $input)\n}",
                "variables": "{\n  \"input\": {\n    \"email\": \"{{testEmail}}\",\n    \"type\": \"EMAIL_VERIFICATION\"\n  }\n}"
              }
            },
            "url": {
              "raw": "{{graphqlEndpoint}}",
              "host": ["{{graphqlEndpoint}}"]
            },
            "description": "Resend OTP code if the original one expired or wasn't received. Has a 1-minute rate limit."
          },
          "response": []
        }
      ],
      "description": "New OTP-based registration flow with email verification"
    },
    {
      "name": "üîë Auth - Login & Session",
      "item": [
        {
          "name": "1. Login",
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "var jsonData = pm.response.json();",
                  "",
                  "if (jsonData.data && jsonData.data.login) {",
                  "    var response = jsonData.data.login;",
                  "    ",
                  "    // Check if 2FA is required",
                  "    if (response.requiresTwoFactor) {",
                  "        pm.environment.set('tempToken', response.tempToken);",
                  "        console.log('‚ö†Ô∏è  2FA required - tempToken stored');",
                  "        console.log('‚ö†Ô∏è  Use the \"Verify 2FA Login\" request with a 2FA code');",
                  "        pm.test('Login requires 2FA', function() {",
                  "            pm.expect(response.requiresTwoFactor).to.be.true;",
                  "            pm.expect(response.tempToken).to.be.a('string').and.to.have.lengthOf.at.least(10);",
                  "        });",
                  "        return; // Exit early - don't process tokens",
                  "    }",
                  "    ",
                  "    var accessToken = response.accessToken;",
                  "    var refreshToken = response.refreshToken;",
                  "    var userId = response.user.id;",
                  "    ",
                  "    pm.environment.set('token', accessToken);",
                  "    pm.environment.set('refreshToken', refreshToken);",
                  "    pm.environment.set('userId', userId);",
                  "    ",
                  "    console.log('‚úì Login successful');",
                  "    console.log('‚úì Access token stored');",
                  "    console.log('‚úì Refresh token stored');",
                  "    console.log('‚úì User ID stored:', userId);",
                  "    ",
                  "    pm.test('Login successful', function() {",
                  "        pm.expect(accessToken).to.be.a('string').and.to.have.lengthOf.at.least(50);",
                  "        pm.expect(refreshToken).to.be.a('string').and.to.have.lengthOf.at.least(50);",
                  "        pm.expect(userId).to.be.a('string');",
                  "        pm.expect(response.user.email).to.be.a('string');",
                  "        pm.expect(['customer', 'admin', 'super_admin']).to.include(response.user.role);",
                  "    });",
                  "} else if (jsonData.errors) {",
                  "    console.error('‚ùå GraphQL errors:', jsonData.errors);",
                  "    var error = jsonData.errors[0];",
                  "    pm.test('Error handling', function() {",
                  "        pm.expect(error.message).to.be.oneOf(['Invalid credentials', 'Account is temporarily locked', 'Account is banned', 'Please verify your email']);",
                  "    });",
                  "}"
                ],
                "type": "text/javascript",
                "packages": {},
                "requests": {}
              }
            }
          ],
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "body": {
              "mode": "graphql",
              "graphql": {
                "query": "mutation Login($input: LoginInput!) {\n  login(input: $input) {\n    accessToken\n    refreshToken\n    user {\n      id\n      email\n      firstName\n      lastName\n      role\n    }\n  }\n}",
                "variables": "{\n  \"input\": {\n    \"email\": \"{{testEmail}}\",\n    \"password\": \"{{testPassword}}\"\n  }\n}"
              }
            },
            "url": {
              "raw": "{{graphqlEndpoint}}",
              "host": ["{{graphqlEndpoint}}"]
            },
            "description": "Login with email and password. Email must be verified first. Returns access and refresh tokens. If 2FA is enabled, returns tempToken instead."
          },
          "response": []
        },
        {
          "name": "2. Who Am I (Get Current User)",
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "var jsonData = pm.response.json();",
                  "",
                  "if (jsonData.data && jsonData.data.whoAmI) {",
                  "    var user = jsonData.data.whoAmI;",
                  "    console.log('‚úì Retrieved current user:', user.email);",
                  "    ",
                  "    pm.test('WhoAmI successful', function() {",
                  "        pm.expect(user.id).to.eql(pm.environment.get('userId'));",
                  "        pm.expect(user.email).to.be.a('string');",
                  "        pm.expect(user.firstName).to.be.a('string');",
                  "        pm.expect(user.lastName).to.be.a('string');",
                  "        pm.expect(['customer', 'admin', 'super_admin']).to.include(user.role);",
                  "    });",
                  "} else if (jsonData.errors) {",
                  "    console.error('‚ùå GraphQL errors:', jsonData.errors);",
                  "    pm.test('Should be authenticated', function() {",
                  "        pm.expect(jsonData.errors[0].message).to.include('Unauthenticated');",
                  "    });",
                  "}"
                ],
                "type": "text/javascript"
              }
            }
          ],
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              },
              {
                "key": "Authorization",
                "value": "Bearer {{token}}"
              }
            ],
            "body": {
              "mode": "graphql",
              "graphql": {
                "query": "query WhoAmI {\n  whoAmI {\n    id\n    email\n    firstName\n    lastName\n    role\n  }\n}",
                "variables": ""
              }
            },
            "url": {
              "raw": "{{graphqlEndpoint}}",
              "host": ["{{graphqlEndpoint}}"]
            },
            "description": "Get current authenticated user info. Requires valid access token."
          },
          "response": []
        },
        {
          "name": "3. Refresh Token",
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "var jsonData = pm.response.json();",
                  "",
                  "if (jsonData.data && jsonData.data.refreshToken) {",
                  "    var response = jsonData.data.refreshToken;",
                  "    var newAccessToken = response.accessToken;",
                  "    var newRefreshToken = response.refreshToken;",
                  "    ",
                  "    pm.environment.set('token', newAccessToken);",
                  "    pm.environment.set('refreshToken', newRefreshToken);",
                  "    ",
                  "    console.log('‚úì Token refresh successful');",
                  "    console.log('‚úì New access token stored');",
                  "    console.log('‚úì New refresh token stored');",
                  "    ",
                  "    pm.test('Token refresh successful', function() {",
                  "        pm.expect(newAccessToken).to.be.a('string').and.to.have.lengthOf.at.least(50);",
                  "        pm.expect(newRefreshToken).to.be.a('string').and.to.have.lengthOf.at.least(50);",
                  "        pm.expect(response.user.id).to.eql(pm.environment.get('userId'));",
                  "    });",
                  "} else if (jsonData.errors) {",
                  "    console.error('‚ùå GraphQL errors:', jsonData.errors);",
                  "    pm.test('Invalid refresh token handling', function() {",
                  "        pm.expect(jsonData.errors[0].message).to.include('Invalid or Expired Refresh Token');",
                  "    });",
                  "}"
                ],
                "type": "text/javascript",
                "packages": {},
                "requests": {}
              }
            }
          ],
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "body": {
              "mode": "graphql",
              "graphql": {
                "query": "mutation RefreshToken($input: RefreshTokenInput!) {\n  refreshToken(input: $input) {\n    accessToken\n    refreshToken\n    user {\n      id\n      email\n      firstName\n      lastName\n      role\n    }\n  }\n}",
                "variables": "{\n  \"input\": {\n    \"token\": \"{{refreshToken}}\"\n  }\n}"
              }
            },
            "url": {
              "raw": "{{graphqlEndpoint}}",
              "host": ["{{graphqlEndpoint}}"]
            },
            "description": "Get new access token using refresh token. Also rotates the refresh token for security."
          },
          "response": []
        },
        {
          "name": "4. Logout",
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "var jsonData = pm.response.json();",
                  "",
                  "if (jsonData.data && jsonData.data.logout === true) {",
                  "    console.log('‚úì Logout successful');",
                  "    console.log('‚úì Refresh token invalidated');",
                  "    ",
                  "    pm.test('Logout successful', function() {",
                  "        pm.expect(jsonData.data.logout).to.be.true;",
                  "    });",
                  "    ",
                  "    // Clear tokens after logout",
                  "    pm.environment.unset('token');",
                  "    pm.environment.unset('refreshToken');",
                  "    console.log('‚úì Environment variables cleared');",
                  "} else if (jsonData.errors) {",
                  "    console.error('‚ùå GraphQL errors:', jsonData.errors);",
                  "}"
                ],
                "type": "text/javascript",
                "packages": {},
                "requests": {}
              }
            }
          ],
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              },
              {
                "key": "Authorization",
                "value": "Bearer {{token}}"
              }
            ],
            "body": {
              "mode": "graphql",
              "graphql": {
                "query": "mutation Logout($userId: String!, $refreshToken: String!) {\n  logout(userId: $userId, refreshToken: $refreshToken)\n}",
                "variables": "{\n  \"userId\": \"{{userId}}\",\n  \"refreshToken\": \"{{refreshToken}}\"\n}"
              }
            },
            "url": {
              "raw": "{{graphqlEndpoint}}",
              "host": ["{{graphqlEndpoint}}"]
            },
            "description": "Logout and invalidate refresh token. Requires both user ID and refresh token."
          },
          "response": []
        }
      ],
      "description": "Login, session management, and token operations"
    },
    {
      "name": "üîí Auth - Password Reset",
      "item": [
        {
          "name": "1. Request Password Reset (Sends OTP)",
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "var jsonData = pm.response.json();",
                  "",
                  "if (jsonData.data && jsonData.data.requestPasswordReset === true) {",
                  "    console.log('‚úì Password reset OTP sent');",
                  "    console.log('‚ö†Ô∏è  Check your email for reset OTP');",
                  "    ",
                  "    pm.test('Password reset request successful', function() {",
                  "        pm.expect(jsonData.data.requestPasswordReset).to.be.true;",
                  "    });",
                  "} else if (jsonData.errors) {",
                  "    console.error('‚ùå GraphQL errors:', jsonData.errors);",
                  "}"
                ],
                "type": "text/javascript",
                "packages": {},
                "requests": {}
              }
            }
          ],
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "body": {
              "mode": "graphql",
              "graphql": {
                "query": "mutation RequestPasswordReset($input: RequestPasswordResetInput!) {\n  requestPasswordReset(input: $input)\n}",
                "variables": "{\n  \"input\": {\n    \"email\": \"{{testEmail}}\"\n  }\n}"
              }
            },
            "url": {
              "raw": "{{graphqlEndpoint}}",
              "host": ["{{graphqlEndpoint}}"]
            },
            "description": "Step 1: Request password reset. This sends an OTP to the user's email. Always returns true to prevent email enumeration."
          },
          "response": []
        },
        {
          "name": "2. Reset Password with OTP",
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "var jsonData = pm.response.json();",
                  "",
                  "if (jsonData.data && jsonData.data.resetPassword === true) {",
                  "    console.log('‚úì Password reset successful');",
                  "    console.log('‚úì All refresh tokens revoked');",
                  "    ",
                  "    pm.test('Password reset successful', function() {",
                  "        pm.expect(jsonData.data.resetPassword).to.be.true;",
                  "    });",
                  "} else if (jsonData.errors) {",
                  "    console.error('‚ùå GraphQL errors:', jsonData.errors);",
                  "    pm.test('Invalid OTP handling', function() {",
                  "        pm.expect(jsonData.errors[0].message).to.include('Invalid or expired OTP');",
                  "    });",
                  "}"
                ],
                "type": "text/javascript",
                "packages": {},
                "requests": {}
              }
            }
          ],
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "body": {
              "mode": "graphql",
              "graphql": {
                "query": "mutation ResetPassword($input: ResetPasswordInput!) {\n  resetPassword(input: $input)\n}",
                "variables": "{\n  \"input\": {\n    \"email\": \"{{testEmail}}\",\n    \"otpCode\": \"{{otpCode}}\",\n    \"newPassword\": \"{{testPassword}}\"\n  }\n}"
              }
            },
            "url": {
              "raw": "{{graphqlEndpoint}}",
              "host": ["{{graphqlEndpoint}}"]
            },
            "description": "Step 2: Reset password using OTP code. Replace '123456' with actual OTP. Password must meet complexity requirements."
          },
          "response": []
        },
        {
          "name": "3. Resend OTP (Password Reset)",
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "var jsonData = pm.response.json();",
                  "",
                  "if (jsonData.data && jsonData.data.resendOtp === true) {",
                  "    console.log('‚úì Password reset OTP resent');",
                  "    pm.test('OTP resent', function() {",
                  "        pm.expect(jsonData.data.resendOtp).to.be.true;",
                  "    });",
                  "} else if (jsonData.errors) {",
                  "    console.error('‚ùå GraphQL errors:', jsonData.errors);",
                  "}"
                ],
                "type": "text/javascript",
                "packages": {},
                "requests": {}
              }
            }
          ],
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "body": {
              "mode": "graphql",
              "graphql": {
                "query": "mutation ResendOtp($input: ResendOtpInput!) {\n  resendOtp(input: $input)\n}",
                "variables": "{\n  \"input\": {\n    \"email\": \"{{testEmail}}\",\n    \"type\": \"PASSWORD_RESET\"\n  }\n}"
              }
            },
            "url": {
              "raw": "{{graphqlEndpoint}}",
              "host": ["{{graphqlEndpoint}}"]
            },
            "description": "Resend password reset OTP if needed. Has a 5-minute rate limit."
          },
          "response": []
        }
      ],
      "description": "Complete password reset flow with OTP verification"
    },
    {
      "name": "üîê Two-Factor Authentication",
      "item": [
        {
          "name": "Setup & Management",
          "item": [
            {
              "name": "1. Initiate 2FA Setup",
              "event": [
                {
                  "listen": "test",
                  "script": {
                    "exec": [
                      "var jsonData = pm.response.json();",
                      "",
                      "if (jsonData.data && jsonData.data.initiate2FASetup) {",
                      "    var response = jsonData.data.initiate2FASetup;",
                      "    ",
                      "    pm.environment.set('twoFactorSecret', response.secret);",
                      "    pm.environment.set('twoFactorQrCode', response.qrCode);",
                      "    ",
                      "    console.log('‚úì 2FA setup initiated');",
                      "    console.log('‚úì Secret stored (use with authenticator app)');",
                      "    console.log('‚úì QR Code stored (data URL)');",
                      "    ",
                      "    pm.test('2FA setup initiated', function() {",
                      "        pm.expect(response.secret).to.be.a('string').and.to.have.lengthOf.at.least(16);",
                      "        pm.expect(response.qrCode).to.be.a('string').and.to.include('data:image/png;base64,');",
                      "        pm.expect(response.manualEntryKey).to.be.a('string');",
                      "        pm.expect(response.message).to.include('authenticator');",
                      "    });",
                      "} else if (jsonData.errors) {",
                      "    console.error('‚ùå GraphQL errors:', jsonData.errors);",
                      "}"
                    ],
                    "type": "text/javascript"
                  }
                }
              ],
              "request": {
                "method": "POST",
                "header": [
                  {
                    "key": "Content-Type",
                    "value": "application/json"
                  },
                  {
                    "key": "Authorization",
                    "value": "Bearer {{token}}"
                  }
                ],
                "body": {
                  "mode": "graphql",
                  "graphql": {
                    "query": "mutation Initiate2FASetup($input: Enable2FAInput!) {\n  initiate2FASetup(input: $input) {\n    secret\n    qrCode\n    manualEntryKey\n    message\n  }\n}",
                    "variables": "{\n  \"input\": {\n    \"password\": \"{{testPassword}}\"\n  }\n}"
                  }
                },
                "url": {
                  "raw": "{{graphqlEndpoint}}",
                  "host": ["{{graphqlEndpoint}}"]
                },
                "description": "Step 1: Initiate 2FA setup. Requires password confirmation. Returns secret and QR code for authenticator app.\n\n‚ö†Ô∏è  IMPORTANT: Scan the QR code with your authenticator app (Google Authenticator, Authy, etc.) or manually enter the secret key.\n\nAfter scanning, you will get 6-digit codes. Use one of those codes in the next step."
              },
              "response": []
            },
            {
              "name": "2. Verify 2FA Setup",
              "event": [
                {
                  "listen": "test",
                  "script": {
                    "exec": [
                      "var jsonData = pm.response.json();",
                      "",
                      "if (jsonData.data && jsonData.data.verify2FASetup === true) {",
                      "    console.log('‚úì 2FA verified and enabled');",
                      "    console.log('‚úì Your account is now protected with 2FA');",
                      "    ",
                      "    pm.test('2FA enabled successfully', function() {",
                      "        pm.expect(jsonData.data.verify2FASetup).to.be.true;",
                      "    });",
                      "} else if (jsonData.errors) {",
                      "    console.error('‚ùå GraphQL errors:', jsonData.errors);",
                      "    pm.test('Valid 2FA token required', function() {",
                      "        pm.expect(jsonData.errors[0].message).to.include('Invalid');",
                      "    });",
                      "}"
                    ],
                    "type": "text/javascript"
                  }
                }
              ],
              "request": {
                "method": "POST",
                "header": [
                  {
                    "key": "Content-Type",
                    "value": "application/json"
                  },
                  {
                    "key": "Authorization",
                    "value": "Bearer {{token}}"
                  }
                ],
                "body": {
                  "mode": "graphql",
                  "graphql": {
                    "query": "mutation Verify2FASetup($input: Verify2FASetupInput!) {\n  verify2FASetup(input: $input)\n}",
                    "variables": "{\n  \"input\": {\n    \"token\": \"{{twoFactorToken}}\"\n  }\n}"
                  }
                },
                "url": {
                  "raw": "{{graphqlEndpoint}}",
                  "host": ["{{graphqlEndpoint}}"]
                },
                "description": "Step 2: Verify 2FA setup. Enter the 6-digit code from your authenticator app to enable 2FA.\n\n‚ö†Ô∏è  You must complete Step 1 first and scan the QR code with an authenticator app.\n\nTo get the code:\n1. Open Google Authenticator/Authy\n2. Find the entry for this app\n3. Enter the current 6-digit code below ({{twoFactorToken}})"
              },
              "response": []
            },
            {
              "name": "3. Get 2FA Status",
              "event": [
                {
                  "listen": "test",
                  "script": {
                    "exec": [
                      "var jsonData = pm.response.json();",
                      "",
                      "if (jsonData.data && jsonData.data.twoFactorStatus) {",
                      "    var status = jsonData.data.twoFactorStatus;",
                      "    console.log('‚úì 2FA Status - Enabled:', status.enabled);",
                      "    console.log('‚úì Backup codes available:', status.hasBackupCodes);",
                      "    console.log('‚úì Backup codes remaining:', status.backupCodesRemaining);",
                      "    ",
                      "    pm.test('2FA status retrieved', function() {",
                      "        pm.expect(status.enabled).to.be.a('boolean');",
                      "        if (status.enabled) {",
                      "            pm.expect(status.enabledAt).to.be.a('string');",
                      "        }",
                      "        pm.expect(status.hasBackupCodes).to.be.a('boolean');",
                      "        pm.expect(status.backupCodesRemaining).to.be.a('number');",
                      "    });",
                      "} else if (jsonData.errors) {",
                      "    console.error('‚ùå GraphQL errors:', jsonData.errors);",
                      "}"
                    ],
                    "type": "text/javascript"
                  }
                }
              ],
              "request": {
                "method": "POST",
                "header": [
                  {
                    "key": "Content-Type",
                    "value": "application/json"
                  },
                  {
                    "key": "Authorization",
                    "value": "Bearer {{token}}"
                  }
                ],
                "body": {
                  "mode": "graphql",
                  "graphql": {
                    "query": "query TwoFactorStatus {\n  twoFactorStatus {\n    enabled\n    enabledAt\n    hasBackupCodes\n    backupCodesRemaining\n  }\n}",
                    "variables": ""
                  }
                },
                "url": {
                  "raw": "{{graphqlEndpoint}}",
                  "host": ["{{graphqlEndpoint}}"]
                },
                "description": "Check 2FA status for the authenticated user. Shows whether 2FA is enabled, when it was enabled, and backup code status."
              },
              "response": []
            },
            {
              "name": "4. Disable 2FA",
              "event": [
                {
                  "listen": "test",
                  "script": {
                    "exec": [
                      "var jsonData = pm.response.json();",
                      "",
                      "if (jsonData.data && jsonData.data.disable2FA === true) {",
                      "    console.log('‚úì 2FA disabled');",
                      "    console.log('‚úì Two-factor authentication has been turned off');",
                      "    ",
                      "    pm.test('2FA disabled successfully', function() {",
                      "        pm.expect(jsonData.data.disable2FA).to.be.true;",
                      "    });",
                      "    ",
                      "    // Clear stored secrets",
                      "    pm.environment.unset('twoFactorSecret');",
                      "    pm.environment.unset('twoFactorQrCode');",
                      "    pm.environment.unset('twoFactorToken');",
                      "} else if (jsonData.errors) {",
                      "    console.error('‚ùå GraphQL errors:', jsonData.errors);",
                      "    pm.test('Requires valid password and 2FA token', function() {",
                      "        pm.expect(jsonData.errors[0].message).to.include('Invalid');",
                      "    });",
                      "}"
                    ],
                    "type": "text/javascript"
                  }
                }
              ],
              "request": {
                "method": "POST",
                "header": [
                  {
                    "key": "Content-Type",
                    "value": "application/json"
                  },
                  {
                    "key": "Authorization",
                    "value": "Bearer {{token}}"
                  }
                ],
                "body": {
                  "mode": "graphql",
                  "graphql": {
                    "query": "mutation Disable2FA($input: Disable2FAInput!) {\n  disable2FA(input: $input)\n}",
                    "variables": "{\n  \"input\": {\n    \"password\": \"{{testPassword}}\",\n    \"token\": \"{{twoFactorToken}}\"\n  }\n}"
                  }
                },
                "url": {
                  "raw": "{{graphqlEndpoint}}",
                  "host": ["{{graphqlEndpoint}}"]
                },
                "description": "Disable 2FA for your account. Requires password and current 2FA token for security.\n\n‚ö†Ô∏è  You must provide a valid 2FA token from your authenticator app to disable 2FA."
              },
              "response": []
            }
          ]
        },
        {
          "name": "Backup Codes",
          "item": [
            {
              "name": "1. Generate Backup Codes",
              "event": [
                {
                  "listen": "test",
                  "script": {
                    "exec": [
                      "var jsonData = pm.response.json();",
                      "",
                      "if (jsonData.data && jsonData.data.generate2FABackupCodes) {",
                      "    var codes = jsonData.data.generate2FABackupCodes.codes;",
                      "    ",
                      "    pm.environment.set('backupCodes', JSON.stringify(codes));",
                      "    pm.environment.set('backupCode', codes[0]); // Use first code for testing",
                      "    ",
                      "    console.log('‚úì Backup codes generated:', codes.length, 'codes');",
                      "    console.log('‚úì First code stored for testing:', codes[0]);",
                      "    console.log('‚ö†Ô∏è  SAVE THESE CODES SECURELY! They can only be used once.');",
                      "    ",
                      "    pm.test('Backup codes generated', function() {",
                      "        pm.expect(codes).to.be.an('array').with.lengthOf(10);",
                      "        pm.expect(codes[0]).to.match(/^[A-Z0-9]{4}-[A-Z0-9]{4}$/);",
                      "        pm.expect(jsonData.data.generate2FABackupCodes.message).to.include('secure');",
                      "    });",
                      "} else if (jsonData.errors) {",
                      "    console.error('‚ùå GraphQL errors:', jsonData.errors);",
                      "    pm.test('Requires valid password', function() {",
                      "        pm.expect(jsonData.errors[0].message).to.include('Invalid password');",
                      "    });",
                      "}"
                    ],
                    "type": "text/javascript"
                  }
                }
              ],
              "request": {
                "method": "POST",
                "header": [
                  {
                    "key": "Content-Type",
                    "value": "application/json"
                  },
                  {
                    "key": "Authorization",
                    "value": "Bearer {{token}}"
                  }
                ],
                "body": {
                  "mode": "graphql",
                  "graphql": {
                    "query": "mutation Generate2FABackupCodes($input: Generate2FABackupCodesInput!) {\n  generate2FABackupCodes(input: $input) {\n    codes\n    message\n  }\n}",
                    "variables": "{\n  \"input\": {\n    \"password\": \"{{testPassword}}\"\n  }\n}"
                  }
                },
                "url": {
                  "raw": "{{graphqlEndpoint}}",
                  "host": ["{{graphqlEndpoint}}"]
                },
                "description": "Generate 10 backup codes for 2FA. Each code can be used once if you lose access to your authenticator app.\n\n‚ö†Ô∏è  WARNING: This will replace any existing backup codes. Save them securely!"
              },
              "response": []
            }
          ]
        },
        {
          "name": "Login with 2FA",
          "item": [
            {
              "name": "1. Verify 2FA Login",
              "event": [
                {
                  "listen": "test",
                  "script": {
                    "exec": [
                      "var jsonData = pm.response.json();",
                      "",
                      "if (jsonData.data && jsonData.data.verify2FALogin) {",
                      "    var response = jsonData.data.verify2FALogin;",
                      "    var accessToken = response.accessToken;",
                      "    var refreshToken = response.refreshToken;",
                      "    var userId = response.user.id;",
                      "    ",
                      "    pm.environment.set('token', accessToken);",
                      "    pm.environment.set('refreshToken', refreshToken);",
                      "    pm.environment.set('userId', userId);",
                      "    ",
                      "    console.log('‚úì 2FA login successful');",
                      "    console.log('‚úì Access token stored');",
                      "    console.log('‚úì Refresh token stored');",
                      "    console.log('‚úì User ID stored:', userId);",
                      "    ",
                      "    pm.test('2FA login successful', function() {",
                      "        pm.expect(accessToken).to.be.a('string').and.to.have.lengthOf.at.least(50);",
                      "        pm.expect(refreshToken).to.be.a('string').and.to.have.lengthOf.at.least(50);",
                      "        pm.expect(userId).to.be.a('string');",
                      "        pm.expect(response.user.email).to.eql(pm.environment.get('testEmail'));",
                      "    });",
                      "    ",
                      "    // Clear temp token after successful login",
                      "    pm.environment.unset('tempToken');",
                      "} else if (jsonData.errors) {",
                      "    console.error('‚ùå GraphQL errors:', jsonData.errors);",
                      "    pm.test('Requires valid 2FA token and temp token', function() {",
                      "        pm.expect(jsonData.errors[0].message).to.include('Invalid');",
                      "    });",
                      "}"
                    ],
                    "type": "text/javascript"
                  }
                }
              ],
              "request": {
                "method": "POST",
                "header": [
                  {
                    "key": "Content-Type",
                    "value": "application/json"
                  }
                ],
                "body": {
                  "mode": "graphql",
                  "graphql": {
                    "query": "mutation Verify2FALogin($input: Verify2FALoginInput!) {\n  verify2FALogin(input: $input) {\n    accessToken\n    refreshToken\n    user {\n      id\n      email\n      firstName\n      lastName\n      role\n    }\n  }\n}",
                    "variables": "{\n  \"input\": {\n    \"email\": \"{{testEmail}}\",\n    \"token\": \"{{twoFactorToken}}\",\n    \"tempToken\": \"{{tempToken}}\"\n  }\n}"
                  }
                },
                "url": {
                  "raw": "{{graphqlEndpoint}}",
                  "host": ["{{graphqlEndpoint}}"]
                },
                "description": "Complete login when 2FA is enabled. Requires the tempToken from the initial login and a 2FA code from your authenticator app.\n\n‚ö†Ô∏è  You must first login normally (which returns tempToken if 2FA is enabled), then use that tempToken here along with a 2FA code."
              },
              "response": []
            },
            {
              "name": "2. Use Backup Code for Login",
              "event": [
                {
                  "listen": "test",
                  "script": {
                    "exec": [
                      "var jsonData = pm.response.json();",
                      "",
                      "if (jsonData.data && jsonData.data.use2FABackupCode) {",
                      "    var response = jsonData.data.use2FABackupCode;",
                      "    var accessToken = response.accessToken;",
                      "    var refreshToken = response.refreshToken;",
                      "    var userId = response.user.id;",
                      "    ",
                      "    pm.environment.set('token', accessToken);",
                      "    pm.environment.set('refreshToken', refreshToken);",
                      "    pm.environment.set('userId', userId);",
                      "    ",
                      "    console.log('‚úì Backup code login successful');",
                      "    console.log('‚úì Access token stored');",
                      "    console.log('‚úì Refresh token stored');",
                      "    console.log('‚ö†Ô∏è  Backup code used - it cannot be used again');",
                      "    ",
                      "    pm.test('Backup code login successful', function() {",
                      "        pm.expect(accessToken).to.be.a('string').and.to.have.lengthOf.at.least(50);",
                      "        pm.expect(refreshToken).to.be.a('string').and.to.have.lengthOf.at.least(50);",
                      "        pm.expect(userId).to.be.a('string');",
                      "        pm.expect(response.user.email).to.eql(pm.environment.get('testEmail'));",
                      "    });",
                      "    ",
                      "    // Clear temp token after successful login",
                      "    pm.environment.unset('tempToken');",
                      "    ",
                      "    // Remove used code from array",
                      "    var codes = JSON.parse(pm.environment.get('backupCodes') || '[]');",
                      "    if (codes.length > 0) {",
                      "        codes.shift(); // Remove first code",
                      "        pm.environment.set('backupCodes', JSON.stringify(codes));",
                      "        console.log('‚úì Remaining backup codes:', codes.length);",
                      "    }",
                      "} else if (jsonData.errors) {",
                      "    console.error('‚ùå GraphQL errors:', jsonData.errors);",
                      "    pm.test('Requires valid backup code and temp token', function() {",
                      "        pm.expect(jsonData.errors[0].message).to.include('Invalid');",
                      "    });",
                      "}"
                    ],
                    "type": "text/javascript"
                  }
                }
              ],
              "request": {
                "method": "POST",
                "header": [
                  {
                    "key": "Content-Type",
                    "value": "application/json"
                  }
                ],
                "body": {
                  "mode": "graphql",
                  "graphql": {
                    "query": "mutation Use2FABackupCode($input: Use2FABackupCodeInput!) {\n  use2FABackupCode(input: $input) {\n    accessToken\n    refreshToken\n    user {\n      id\n      email\n      firstName\n      lastName\n      role\n    }\n  }\n}",
                    "variables": "{\n  \"input\": {\n    \"email\": \"{{testEmail}}\",\n    \"backupCode\": \"{{backupCode}}\",\n    \"tempToken\": \"{{tempToken}}\"\n  }\n}"
                  }
                },
                "url": {
                  "raw": "{{graphqlEndpoint}}",
                  "host": ["{{graphqlEndpoint}}"]
                },
                "description": "Login using a backup code when you don't have access to your authenticator app.\n\n‚ö†Ô∏è  You must first login normally (which returns tempToken if 2FA is enabled), then use that tempToken here along with a backup code.\n\n‚ö†Ô∏è  Each backup code can only be used ONCE. After using it, it will be removed from your account."
              },
              "response": []
            }
          ]
        }
      ]
    },
    {
      "name": "üîó OAuth - Social Login",
      "item": [
        {
          "name": "1. Google OAuth - Initiate",
          "request": {
            "method": "GET",
            "header": [],
            "url": {
              "raw": "{{baseUrl}}/auth/google",
              "host": ["{{baseUrl}}"],
              "path": ["auth", "google"]
            },
            "description": "Initiates Google OAuth flow. Opens in browser, redirects to Google login. In development, returns HTML page with tokens. In production, redirects to frontend with tokens in URL."
          },
          "response": []
        },
        {
          "name": "2. GitHub OAuth - Initiate",
          "request": {
            "method": "GET",
            "header": [],
            "url": {
              "raw": "{{baseUrl}}/auth/github",
              "host": ["{{baseUrl}}"],
              "path": ["auth", "github"]
            },
            "description": "Initiates GitHub OAuth flow. Opens in browser, redirects to GitHub login. Handles email verification automatically for new users."
          },
          "response": []
        },
        {
          "name": "3. Google OAuth - Test Callback",
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "pm.test('Google OAuth test callback', function() {",
                  "    pm.response.to.have.status(200);",
                  "});",
                  "",
                  "var jsonData = pm.response.json();",
                  "if (jsonData.success && jsonData.tokens) {",
                  "    pm.environment.set('token', jsonData.tokens.accessToken);",
                  "    pm.environment.set('refreshToken', jsonData.tokens.refreshToken);",
                  "    pm.environment.set('userId', jsonData.user.id);",
                  "    console.log('‚úì Google OAuth test successful');",
                  "    console.log('‚úì Tokens stored from Google login');",
                  "}"
                ],
                "type": "text/javascript"
              }
            }
          ],
          "request": {
            "method": "GET",
            "header": [],
            "url": {
              "raw": "{{baseUrl}}/auth/google/callback/test",
              "host": ["{{baseUrl}}"],
              "path": ["auth", "google", "callback", "test"]
            },
            "description": "Test endpoint for Google OAuth callback (development only). Returns JSON with tokens instead of redirecting."
          },
          "response": []
        },
        {
          "name": "4. GitHub OAuth - Test Callback",
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "pm.test('GitHub OAuth test callback', function() {",
                  "    pm.response.to.have.status(200);",
                  "});",
                  "",
                  "var jsonData = pm.response.json();",
                  "if (jsonData.success && jsonData.tokens) {",
                  "    pm.environment.set('token', jsonData.tokens.accessToken);",
                  "    pm.environment.set('refreshToken', jsonData.tokens.refreshToken);",
                  "    pm.environment.set('userId', jsonData.user.id);",
                  "    console.log('‚úì GitHub OAuth test successful');",
                  "    console.log('‚úì Tokens stored from GitHub login');",
                  "}"
                ],
                "type": "text/javascript"
              }
            }
          ],
          "request": {
            "method": "GET",
            "header": [],
            "url": {
              "raw": "{{baseUrl}}/auth/github/callback/test",
              "host": ["{{baseUrl}}"],
              "path": ["auth", "github", "callback", "test"]
            },
            "description": "Test endpoint for GitHub OAuth callback (development only). Returns JSON with tokens instead of redirecting."
          },
          "response": []
        },
        {
          "name": "5. Check OAuth Status",
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "pm.test('OAuth status check', function() {",
                  "    pm.response.to.have.status(200);",
                  "});",
                  "",
                  "var jsonData = pm.response.json();",
                  "console.log('Google configured:', jsonData.google.configured);",
                  "console.log('GitHub configured:', jsonData.github.configured);"
                ],
                "type": "text/javascript"
              }
            }
          ],
          "request": {
            "method": "GET",
            "header": [],
            "url": {
              "raw": "{{baseUrl}}/auth/status",
              "host": ["{{baseUrl}}"],
              "path": ["auth", "status"]
            },
            "description": "Check OAuth configuration status. Shows whether Google/GitHub OAuth is configured and callback URLs."
          },
          "response": []
        }
      ],
      "description": "OAuth social login endpoints for Google and GitHub. Includes development test endpoints."
    },
    {
      "name": "üë§ Users - Public",
      "item": [
        {
          "name": "Get User by ID (Public)",
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "var jsonData = pm.response.json();",
                  "",
                  "if (jsonData.data && jsonData.data.user) {",
                  "    var user = jsonData.data.user;",
                  "    console.log('‚úì Retrieved public user profile:', user._id);",
                  "    ",
                  "    pm.test('Public user data is limited', function() {",
                  "        pm.expect(user._id).to.be.a('string');",
                  "        pm.expect(user.email).to.be.undefined;",
                  "        pm.expect(user.firstName).to.be.a('string');",
                  "        pm.expect(user.lastName).to.be.a('string');",
                  "        pm.expect(user.fullName).to.be.a('string');",
                  "        pm.expect(user.role).to.be.oneOf(['customer', 'admin', 'super_admin', 'vendor', 'moderator', 'support']);",
                  "    });",
                  "} else if (jsonData.errors) {",
                  "    console.error('‚ùå GraphQL errors:', jsonData.errors);",
                  "}"
                ],
                "type": "text/javascript"
              }
            }
          ],
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "body": {
              "mode": "graphql",
              "graphql": {
                "query": "query GetUser($id: ID!) {\n  user(id: $id) {\n    _id\n    firstName\n    lastName\n    fullName\n    username\n    displayName\n    avatar\n    role\n    createdAt\n    updatedAt\n  }\n}",
                "variables": "{\n  \"id\": \"{{userId}}\"\n}"
              }
            },
            "url": {
              "raw": "{{graphqlEndpoint}}",
              "host": ["{{graphqlEndpoint}}"]
            },
            "description": "Get public user information by ID. Does not expose sensitive data like email or addresses."
          },
          "response": []
        }
      ],
      "description": "Public user endpoints that don't require authentication"
    },
    {
      "name": "üë§ Users - Protected",
      "item": [
        {
          "name": "1. Get My Profile",
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "var jsonData = pm.response.json();",
                  "",
                  "if (jsonData.data && jsonData.data.me) {",
                  "    var user = jsonData.data.me;",
                  "    console.log('‚úì Retrieved full profile:', user.email);",
                  "    ",
                  "    pm.test('Full profile retrieved', function() {",
                  "        pm.expect(user._id).to.eql(pm.environment.get('userId'));",
                  "        pm.expect(user.email).to.be.a('string');",
                  "        pm.expect(user.addresses).to.be.an('array');",
                  "        pm.expect(user.isEmailVerified).to.be.a('boolean');",
                  "        pm.expect(user.isActive).to.be.true;",
                  "    });",
                  "} else if (jsonData.errors) {",
                  "    console.error('‚ùå GraphQL errors:', jsonData.errors);",
                  "}"
                ],
                "type": "text/javascript",
                "packages": {},
                "requests": {}
              }
            }
          ],
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              },
              {
                "key": "Authorization",
                "value": "Bearer {{token}}"
              }
            ],
            "body": {
              "mode": "graphql",
              "graphql": {
                "query": "query GetMe {\n  me {\n    _id\n    firstName\n    lastName\n    fullName\n    username\n    displayName\n    email\n    role\n    status\n    avatar\n    addresses {\n      _id\n      address\n      city\n      country\n      postalCode\n      phoneNumber\n      isDefault\n      label\n      recipientName\n      recipientPhone\n      instructions\n      coordinates {\n        lat\n        lng\n      }\n    }\n    isEmailVerified\n    phone\n    phoneVerified\n    lastLogin\n    isActive\n    preferredLanguage\n    preferredCurrency\n    dateOfBirth\n    gender\n    twoFactorEnabled\n    newsletter\n    termsAcceptedAt\n    privacyPolicyAcceptedAt\n    createdAt\n    updatedAt\n  }\n}",
                "variables": ""
              }
            },
            "url": {
              "raw": "{{graphqlEndpoint}}",
              "host": ["{{graphqlEndpoint}}"]
            },
            "description": "Get complete profile of authenticated user including private fields."
          },
          "response": []
        },
        {
          "name": "2. Update My Profile",
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "var jsonData = pm.response.json();",
                  "",
                  "if (jsonData.data && jsonData.data.updateUser) {",
                  "    var user = jsonData.data.updateUser;",
                  "    console.log('‚úì Profile updated:', user._id);",
                  "    ",
                  "    pm.test('Profile updated successfully', function() {",
                  "        pm.expect(user._id).to.eql(pm.environment.get('userId'));",
                  "        pm.expect(user.firstName).to.eql('Johnny');",
                  "        pm.expect(user.username).to.match(/^[a-zA-Z0-9_-]+$/);",
                  "    });",
                  "} else if (jsonData.errors) {",
                  "    console.error('‚ùå GraphQL errors:', jsonData.errors);",
                  "}"
                ],
                "type": "text/javascript",
                "packages": {},
                "requests": {}
              }
            }
          ],
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              },
              {
                "key": "Authorization",
                "value": "Bearer {{token}}"
              }
            ],
            "body": {
              "mode": "graphql",
              "graphql": {
                "query": "mutation UpdateUser($input: UpdateUserInput!) {\n  updateUser(input: $input) {\n    _id\n    firstName\n    lastName\n    username\n    displayName\n    phone\n    avatar\n    preferredLanguage\n    preferredCurrency\n    dateOfBirth\n    gender\n    newsletter\n    updatedAt\n  }\n}",
                "variables": "{\n  \"input\": {\n    \"firstName\": \"Johnny\",\n    \"lastName\": \"Doe\",\n    \"username\": \"johndoe_{{$randomInt}}\",\n    \"displayName\": \"Johnny Doe\",\n    \"phone\": \"+201554726680\",\n    \"preferredLanguage\": \"en\",\n    \"preferredCurrency\": \"USD\",\n    \"gender\": \"male\",\n    \"newsletter\": true\n  }\n}"
              }
            },
            "url": {
              "raw": "{{graphqlEndpoint}}",
              "host": ["{{graphqlEndpoint}}"]
            },
            "description": "Update user profile information. All fields are optional. Username must be unique."
          },
          "response": []
        },
        {
          "name": "3. Delete My Account",
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "var jsonData = pm.response.json();",
                  "",
                  "if (jsonData.data && jsonData.data.deleteUser) {",
                  "    var user = jsonData.data.deleteUser;",
                  "    console.log('‚úì Account deleted (soft delete):', user._id);",
                  "    ",
                  "    pm.test('Account soft deleted', function() {",
                  "        pm.expect(user._id).to.eql(pm.environment.get('userId'));",
                  "        pm.expect(user.isActive).to.be.false;",
                  "        pm.expect(user.email).to.be.a('string');",
                  "    });",
                  "}"
                ],
                "type": "text/javascript",
                "packages": {},
                "requests": {}
              }
            }
          ],
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              },
              {
                "key": "Authorization",
                "value": "Bearer {{token}}"
              }
            ],
            "body": {
              "mode": "graphql",
              "graphql": {
                "query": "mutation DeleteUser {\n  deleteUser {\n    _id\n    email\n    isActive\n  }\n}",
                "variables": ""
              }
            },
            "url": {
              "raw": "{{graphqlEndpoint}}",
              "host": ["{{graphqlEndpoint}}"]
            },
            "description": "Soft delete user account (sets isActive to false). User data is preserved for audit purposes."
          },
          "response": []
        }
      ],
      "description": "User profile management for authenticated users"
    },
    {
      "name": "üìç Addresses",
      "item": [
        {
          "name": "1. Add Address",
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "var jsonData = pm.response.json();",
                  "",
                  "if (jsonData.data && jsonData.data.addAddress && jsonData.data.addAddress.addresses) {",
                  "    var addresses = jsonData.data.addAddress.addresses;",
                  "    if (addresses.length > 0) {",
                  "        var addressId = addresses[addresses.length - 1]._id;",
                  "        pm.environment.set('addressId', addressId);",
                  "        console.log('‚úì Address added:', addressId);",
                  "        console.log('‚úì Address ID stored');",
                  "        ",
                  "        pm.test('Address added successfully', function() {",
                  "            pm.expect(addressId).to.be.a('string');",
                  "            pm.expect(addresses.length).to.be.at.least(1);",
                  "            pm.expect(addresses[addresses.length - 1].isDefault).to.be.true;",
                  "        });",
                  "    }",
                  "} else if (jsonData.errors) {",
                  "    console.error('‚ùå GraphQL errors:', jsonData.errors);",
                  "}"
                ],
                "type": "text/javascript"
              }
            }
          ],
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              },
              {
                "key": "Authorization",
                "value": "Bearer {{token}}"
              }
            ],
            "body": {
              "mode": "graphql",
              "graphql": {
                "query": "mutation AddAddress($input: AddAddressInput!) {\n  addAddress(input: $input) {\n    _id\n    addresses {\n      _id\n      address\n      city\n      country\n      postalCode\n      phoneNumber\n      isDefault\n      label\n      recipientName\n      recipientPhone\n      instructions\n      coordinates {\n        lat\n        lng\n      }\n      createdAt\n      updatedAt\n    }\n  }\n}",
                "variables": "{\n  \"input\": {\n    \"address\": {\n      \"address\": \"123 Main Street, Apt 4B\",\n      \"city\": \"New York\",\n      \"country\": \"USA\",\n      \"postalCode\": \"10001\",\n      \"phoneNumber\": \"+1234567890\",\n      \"isDefault\": true,\n      \"label\": \"Home\",\n      \"recipientName\": \"John Doe\",\n      \"recipientPhone\": \"+1234567890\",\n      \"instructions\": \"Ring doorbell twice, leave at door if no answer\",\n      \"coordinates\": {\n        \"lat\": 40.7128,\n        \"lng\": -74.006\n      }\n    }\n  }\n}"
              }
            },
            "url": {
              "raw": "{{graphqlEndpoint}}",
              "host": ["{{graphqlEndpoint}}"]
            },
            "description": "Add new address to user profile. If isDefault is true, all other addresses will have isDefault set to false."
          },
          "response": []
        },
        {
          "name": "2. Update Address",
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "var jsonData = pm.response.json();",
                  "",
                  "if (jsonData.data && jsonData.data.updateAddress) {",
                  "    var user = jsonData.data.updateAddress;",
                  "    console.log('‚úì Address updated:', pm.environment.get('addressId'));",
                  "    ",
                  "    pm.test('Address updated successfully', function() {",
                  "        pm.expect(user._id).to.eql(pm.environment.get('userId'));",
                  "        var address = user.addresses.find(a => a._id === pm.environment.get('addressId'));",
                  "        pm.expect(address.city).to.eql('Brooklyn');",
                  "        pm.expect(address.label).to.eql('Work');",
                  "    });",
                  "}"
                ],
                "type": "text/javascript"
              }
            }
          ],
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              },
              {
                "key": "Authorization",
                "value": "Bearer {{token}}"
              }
            ],
            "body": {
              "mode": "graphql",
              "graphql": {
                "query": "mutation UpdateAddress($addressId: ID!, $input: UpdateAddressInput!) {\n  updateAddress(addressId: $addressId, input: $input) {\n    _id\n    addresses {\n      _id\n      address\n      city\n      country\n      postalCode\n      phoneNumber\n      isDefault\n      label\n      updatedAt\n    }\n  }\n}",
                "variables": "{\n  \"addressId\": \"{{addressId}}\",\n  \"input\": {\n    \"address\": {\n      \"address\": \"456 Updated Street, Floor 2\",\n      \"city\": \"Brooklyn\",\n      \"country\": \"USA\",\n      \"postalCode\": \"11201\",\n      \"phoneNumber\": \"+1987654321\",\n      \"isDefault\": false,\n      \"label\": \"Work\"\n    }\n  }\n}"
              }
            },
            "url": {
              "raw": "{{graphqlEndpoint}}",
              "host": ["{{graphqlEndpoint}}"]
            },
            "description": "Update existing address. Must provide addressId and full address object."
          },
          "response": []
        },
        {
          "name": "3. Set Default Address",
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "var jsonData = pm.response.json();",
                  "",
                  "if (jsonData.data && jsonData.data.setDefaultAddress) {",
                  "    var user = jsonData.data.setDefaultAddress;",
                  "    console.log('‚úì Default address set:', pm.environment.get('addressId'));",
                  "    ",
                  "    pm.test('Default address updated', function() {",
                  "        var address = user.addresses.find(a => a._id === pm.environment.get('addressId'));",
                  "        pm.expect(address.isDefault).to.be.true;",
                  "        var otherAddresses = user.addresses.filter(a => a._id !== pm.environment.get('addressId'));",
                  "        otherAddresses.forEach(a => {",
                  "            pm.expect(a.isDefault).to.be.false;",
                  "        });",
                  "    });",
                  "}"
                ],
                "type": "text/javascript"
              }
            }
          ],
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              },
              {
                "key": "Authorization",
                "value": "Bearer {{token}}"
              }
            ],
            "body": {
              "mode": "graphql",
              "graphql": {
                "query": "mutation SetDefaultAddress($addressId: ID!) {\n  setDefaultAddress(addressId: $addressId) {\n    _id\n    addresses {\n      _id\n      address\n      isDefault\n    }\n  }\n}",
                "variables": "{\n  \"addressId\": \"{{addressId}}\"\n}"
              }
            },
            "url": {
              "raw": "{{graphqlEndpoint}}",
              "host": ["{{graphqlEndpoint}}"]
            },
            "description": "Set address as default. Automatically unsets isDefault for all other addresses."
          },
          "response": []
        },
        {
          "name": "4. Delete Address",
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "var jsonData = pm.response.json();",
                  "",
                  "if (jsonData.data && jsonData.data.deleteAddress) {",
                  "    var user = jsonData.data.deleteAddress;",
                  "    console.log('‚úì Address deleted:', pm.environment.get('addressId'));",
                  "    ",
                  "    pm.test('Address deleted successfully', function() {",
                  "        pm.expect(user._id).to.eql(pm.environment.get('userId'));",
                  "        var deletedAddress = user.addresses.find(a => a._id === pm.environment.get('addressId'));",
                  "        pm.expect(deletedAddress).to.be.undefined;",
                  "    });",
                  "}"
                ],
                "type": "text/javascript"
              }
            }
          ],
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              },
              {
                "key": "Authorization",
                "value": "Bearer {{token}}"
              }
            ],
            "body": {
              "mode": "graphql",
              "graphql": {
                "query": "mutation DeleteAddress($addressId: ID!) {\n  deleteAddress(addressId: $addressId) {\n    _id\n    addresses {\n      _id\n      address\n      city\n    }\n  }\n}",
                "variables": "{\n  \"addressId\": \"{{addressId}}\"\n}"
              }
            },
            "url": {
              "raw": "{{graphqlEndpoint}}",
              "host": ["{{graphqlEndpoint}}"]
            },
            "description": "Delete an address from user profile. Cannot be undone."
          },
          "response": []
        }
      ],
      "description": "Manage user addresses with full CRUD operations"
    },
    {
      "name": "üîî Notifications",
      "item": [
        {
          "name": "User - Queries",
          "item": [
            {
              "name": "1. Get My Notifications (Paginated)",
              "event": [
                {
                  "listen": "test",
                  "script": {
                    "exec": [
                      "var jsonData = pm.response.json();\n",
                      "if (jsonData.data && jsonData.data.myNotifications) {\n",
                      "    var result = jsonData.data.myNotifications;\n",
                      "    console.log('‚úì Retrieved', result.notifications.length, 'notifications');\n",
                      "    console.log('‚úì Unread count:', result.unreadCount);\n",
                      "    console.log('‚úì Total notifications:', result.total);\n",
                      "    ",
                      "    if (result.notifications.length > 0) {\n",
                      "        pm.environment.set('notificationId', result.notifications[0]._id);\n",
                      "        console.log('‚úì Stored first notification ID:', result.notifications[0]._id);\n",
                      "    }\n",
                      "    ",
                      "    pm.test('Notifications retrieved successfully', function() {\n",
                      "        pm.expect(result.notifications).to.be.an('array');\n",
                      "        pm.expect(result.total).to.be.a('number');\n",
                      "        pm.expect(result.unreadCount).to.be.a('number');\n",
                      "        pm.expect(result.page).to.eql(1);\n",
                      "        pm.expect(result.limit).to.eql(20);\n",
                      "    });\n",
                      "} else if (jsonData.errors) {\n",
                      "    console.error('‚ùå GraphQL errors:', jsonData.errors);\n",
                      "}"
                    ],
                    "type": "text/javascript",
                    "packages": {},
                    "requests": {}
                  }
                }
              ],
              "request": {
                "method": "POST",
                "header": [
                  {
                    "key": "Content-Type",
                    "value": "application/json"
                  },
                  {
                    "key": "Authorization",
                    "value": "Bearer {{token}}"
                  }
                ],
                "body": {
                  "mode": "graphql",
                  "graphql": {
                    "query": "query GetMyNotifications($filters: NotificationFiltersInput) {\n  myNotifications(filters: $filters) {\n    notifications {\n      _id\n      title\n      message\n      type\n      priority\n      channels\n      isRead\n      readAt\n      data\n      actionUrl\n      actionText\n      imageUrl\n      icon\n      emailSent\n      pushSent\n      createdAt\n    }\n    total\n    unreadCount\n    page\n    limit\n    totalPages\n  }\n}",
                    "variables": "{\n  \"filters\": {\n    \"page\": 1,\n    \"limit\": 20\n  }\n}"
                  }
                },
                "url": {
                  "raw": "{{graphqlEndpoint}}",
                  "host": ["{{graphqlEndpoint}}"]
                },
                "description": "Get paginated list of user's notifications. Returns unread count and total. Accepts filters for type, read status, and pagination."
              },
              "response": []
            },
            {
              "name": "2. Get Notification by ID",
              "event": [
                {
                  "listen": "test",
                  "script": {
                    "exec": [
                      "var jsonData = pm.response.json();\n",
                      "if (jsonData.data && jsonData.data.notification) {\n",
                      "    var notification = jsonData.data.notification;\n",
                      "    console.log('‚úì Notification retrieved:', notification._id);\n",
                      "    ",
                      "    pm.test('Notification details retrieved', function() {\n",
                      "        pm.expect(notification._id).to.eql(pm.environment.get('notificationId'));\n",
                      "        pm.expect(notification.title).to.be.a('string');\n",
                      "        pm.expect(notification.type).to.be.a('string');\n",
                      "    });\n",
                      "} else if (jsonData.errors) {\n",
                      "    console.error('‚ùå GraphQL errors:', jsonData.errors);\n",
                      "}"
                    ],
                    "type": "text/javascript",
                    "packages": {},
                    "requests": {}
                  }
                }
              ],
              "request": {
                "method": "POST",
                "header": [
                  {
                    "key": "Content-Type",
                    "value": "application/json"
                  },
                  {
                    "key": "Authorization",
                    "value": "Bearer {{token}}"
                  }
                ],
                "body": {
                  "mode": "graphql",
                  "graphql": {
                    "query": "query GetNotification($id: ID!) {\n  notification(id: $id) {\n    _id\n    title\n    message\n    type\n    priority\n    channels\n    isRead\n    readAt\n    data\n    actionUrl\n    actionText\n    imageUrl\n    icon\n    emailSent\n    emailSentAt\n    pushSent\n    pushSentAt\n    createdAt\n  }\n}",
                    "variables": "{\n  \"id\": \"{{notificationId}}\"\n}"
                  }
                },
                "url": {
                  "raw": "{{graphqlEndpoint}}",
                  "host": ["{{graphqlEndpoint}}"]
                },
                "description": "Get single notification by ID. Must belong to the authenticated user."
              },
              "response": []
            },
            {
              "name": "3. Get Notification Stats",
              "event": [
                {
                  "listen": "test",
                  "script": {
                    "exec": [
                      "var jsonData = pm.response.json();\n",
                      "if (jsonData.data && jsonData.data.notificationStats) {\n",
                      "    var stats = jsonData.data.notificationStats;\n",
                      "    console.log('‚úì Total notifications:', stats.total);\n",
                      "    console.log('‚úì Unread:', stats.unread);\n",
                      "    console.log('‚úì Read:', stats.read);\n",
                      "    console.log('‚úì Archived:', stats.archived);\n",
                      "    console.log('‚úì By type:', stats.byType.length, 'types');\n",
                      "    ",
                      "    pm.test('Notification stats retrieved', function() {\n",
                      "        pm.expect(stats.total).to.be.a('number');\n",
                      "        pm.expect(stats.unread).to.be.a('number');\n",
                      "        pm.expect(stats.read).to.be.a('number');\n",
                      "        pm.expect(stats.archived).to.be.a('number');\n",
                      "        pm.expect(stats.byType).to.be.an('array');\n",
                      "    });\n",
                      "} else if (jsonData.errors) {\n",
                      "    console.error('‚ùå GraphQL errors:', jsonData.errors);\n",
                      "}"
                    ],
                    "type": "text/javascript",
                    "packages": {},
                    "requests": {}
                  }
                }
              ],
              "request": {
                "method": "POST",
                "header": [
                  {
                    "key": "Content-Type",
                    "value": "application/json"
                  },
                  {
                    "key": "Authorization",
                    "value": "Bearer {{token}}"
                  }
                ],
                "body": {
                  "mode": "graphql",
                  "graphql": {
                    "query": "query GetNotificationStats {\n  notificationStats {\n    total\n    unread\n    read\n    archived\n    byType {\n      type\n      count\n      unreadCount\n    }\n  }\n}",
                    "variables": ""
                  }
                },
                "url": {
                  "raw": "{{graphqlEndpoint}}",
                  "host": ["{{graphqlEndpoint}}"]
                },
                "description": "Get notification statistics including total, read/unread counts, and breakdown by type."
              },
              "response": []
            },
            {
              "name": "4. Get Notification Preferences",
              "event": [
                {
                  "listen": "test",
                  "script": {
                    "exec": [
                      "var jsonData = pm.response.json();\n",
                      "if (jsonData.data && jsonData.data.notificationPreferences) {\n",
                      "    var prefs = jsonData.data.notificationPreferences;\n",
                      "    console.log('‚úì Notification preferences retrieved');\n",
                      "    console.log('‚úì Enabled:', prefs.enabled);\n",
                      "    console.log('‚úì Email enabled:', prefs.emailEnabled);\n",
                      "    console.log('‚úì Push enabled:', prefs.pushEnabled);\n",
                      "    console.log('‚úì Type preferences:', prefs.typePreferences.length, 'types');\n",
                      "    ",
                      "    pm.test('Notification preferences retrieved', function() {\n",
                      "        pm.expect(prefs.userId).to.be.a('string');\n",
                      "        pm.expect(prefs.enabled).to.be.a('boolean');\n",
                      "        pm.expect(prefs.typePreferences).to.be.an('array');\n",
                      "        pm.expect(prefs.doNotDisturb).to.be.a('boolean');\n",
                      "    });\n",
                      "} else if (jsonData.errors) {\n",
                      "    console.error('‚ùå GraphQL errors:', jsonData.errors);\n",
                      "}"
                    ],
                    "type": "text/javascript",
                    "packages": {},
                    "requests": {}
                  }
                }
              ],
              "request": {
                "method": "POST",
                "header": [
                  {
                    "key": "Content-Type",
                    "value": "application/json"
                  },
                  {
                    "key": "Authorization",
                    "value": "Bearer {{token}}"
                  }
                ],
                "body": {
                  "mode": "graphql",
                  "graphql": {
                    "query": "query GetNotificationPreferences {\n  notificationPreferences {\n    _id\n    userId\n    enabled\n    emailEnabled\n    pushEnabled\n    smsEnabled\n    quietHours {\n      enabled\n      startHour\n      endHour\n      timezone\n    }\n    enableDigest\n    digestFrequency\n    digestTime\n    typePreferences {\n      type\n      channels\n      enabled\n    }\n    doNotDisturb\n    doNotDisturbUntil\n    createdAt\n    updatedAt\n  }\n}",
                    "variables": ""
                  }
                },
                "url": {
                  "raw": "{{graphqlEndpoint}}",
                  "host": ["{{graphqlEndpoint}}"]
                },
                "description": "Get user's notification preferences including channel settings, quiet hours, and type-specific preferences."
              },
              "response": []
            }
          ]
        },
        {
          "name": "User - Mutations",
          "item": [
            {
              "name": "1. Mark Notifications as Read",
              "event": [
                {
                  "listen": "test",
                  "script": {
                    "exec": [
                      "var jsonData = pm.response.json();\n",
                      "if (jsonData.data && jsonData.data.markNotificationsAsRead === true) {\n",
                      "    console.log('‚úì Notifications marked as read');\n",
                      "    pm.test('Mark as read successful', function() {\n",
                      "        pm.expect(jsonData.data.markNotificationsAsRead).to.be.true;\n",
                      "    });\n",
                      "} else if (jsonData.errors) {\n",
                      "    console.error('‚ùå GraphQL errors:', jsonData.errors);\n",
                      "}"
                    ],
                    "type": "text/javascript",
                    "packages": {},
                    "requests": {}
                  }
                }
              ],
              "request": {
                "method": "POST",
                "header": [
                  {
                    "key": "Content-Type",
                    "value": "application/json"
                  },
                  {
                    "key": "Authorization",
                    "value": "Bearer {{token}}"
                  }
                ],
                "body": {
                  "mode": "graphql",
                  "graphql": {
                    "query": "mutation MarkNotificationsAsRead($input: MarkNotificationsInput!) {\n  markNotificationsAsRead(input: $input)\n}",
                    "variables": "{\n  \"input\": {\n    \"notificationIds\": [\"{{notificationId}}\"],\n    \"isRead\": true\n  }\n}"
                  }
                },
                "url": {
                  "raw": "{{graphqlEndpoint}}",
                  "host": ["{{graphqlEndpoint}}"]
                },
                "description": "Mark specific notifications as read. Updates readAt timestamp."
              },
              "response": []
            },
            {
              "name": "2. Mark All Notifications as Read",
              "event": [
                {
                  "listen": "test",
                  "script": {
                    "exec": [
                      "var jsonData = pm.response.json();\n",
                      "if (jsonData.data && jsonData.data.markAllNotificationsAsRead === true) {\n",
                      "    console.log('‚úì All notifications marked as read');\n",
                      "    pm.test('Mark all as read successful', function() {\n",
                      "        pm.expect(jsonData.data.markAllNotificationsAsRead).to.be.true;\n",
                      "    });\n",
                      "} else if (jsonData.errors) {\n",
                      "    console.error('‚ùå GraphQL errors:', jsonData.errors);\n",
                      "}"
                    ],
                    "type": "text/javascript",
                    "packages": {},
                    "requests": {}
                  }
                }
              ],
              "request": {
                "method": "POST",
                "header": [
                  {
                    "key": "Content-Type",
                    "value": "application/json"
                  },
                  {
                    "key": "Authorization",
                    "value": "Bearer {{token}}"
                  }
                ],
                "body": {
                  "mode": "graphql",
                  "graphql": {
                    "query": "mutation MarkAllNotificationsAsRead {\n  markAllNotificationsAsRead\n}",
                    "variables": ""
                  }
                },
                "url": {
                  "raw": "{{graphqlEndpoint}}",
                  "host": ["{{graphqlEndpoint}}"]
                },
                "description": "Mark all unread notifications as read in one operation."
              },
              "response": []
            },
            {
              "name": "3. Archive Notifications",
              "event": [
                {
                  "listen": "test",
                  "script": {
                    "exec": [
                      "var jsonData = pm.response.json();\n",
                      "if (jsonData.data && jsonData.data.archiveNotifications === true) {\n",
                      "    console.log('‚úì Notifications archived');\n",
                      "    pm.test('Archive successful', function() {\n",
                      "        pm.expect(jsonData.data.archiveNotifications).to.be.true;\n",
                      "    });\n",
                      "} else if (jsonData.errors) {\n",
                      "    console.error('‚ùå GraphQL errors:', jsonData.errors);\n",
                      "}"
                    ],
                    "type": "text/javascript",
                    "packages": {},
                    "requests": {}
                  }
                }
              ],
              "request": {
                "method": "POST",
                "header": [
                  {
                    "key": "Content-Type",
                    "value": "application/json"
                  },
                  {
                    "key": "Authorization",
                    "value": "Bearer {{token}}"
                  }
                ],
                "body": {
                  "mode": "graphql",
                  "graphql": {
                    "query": "mutation ArchiveNotifications($notificationIds: [ID!]!) {\n  archiveNotifications(notificationIds: $notificationIds)\n}",
                    "variables": "{\n  \"notificationIds\": [\"{{notificationId}}\"]\n}"
                  }
                },
                "url": {
                  "raw": "{{graphqlEndpoint}}",
                  "host": ["{{graphqlEndpoint}}"]
                },
                "description": "Archive notifications to clean up inbox. Archived notifications don't appear in main list."
              },
              "response": []
            },
            {
              "name": "4. Delete Notifications",
              "event": [
                {
                  "listen": "test",
                  "script": {
                    "exec": [
                      "var jsonData = pm.response.json();\n",
                      "if (jsonData.data && jsonData.data.deleteNotifications === true) {\n",
                      "    console.log('‚úì Notifications deleted');\n",
                      "    pm.test('Delete successful', function() {\n",
                      "        pm.expect(jsonData.data.deleteNotifications).to.be.true;\n",
                      "    });\n",
                      "    ",
                      "    pm.environment.unset('notificationId');\n",
                      "} else if (jsonData.errors) {\n",
                      "    console.error('‚ùå GraphQL errors:', jsonData.errors);\n",
                      "}"
                    ],
                    "type": "text/javascript",
                    "packages": {},
                    "requests": {}
                  }
                }
              ],
              "request": {
                "method": "POST",
                "header": [
                  {
                    "key": "Content-Type",
                    "value": "application/json"
                  },
                  {
                    "key": "Authorization",
                    "value": "Bearer {{token}}"
                  }
                ],
                "body": {
                  "mode": "graphql",
                  "graphql": {
                    "query": "mutation DeleteNotifications($notificationIds: [ID!]!) {\n  deleteNotifications(notificationIds: $notificationIds)\n}",
                    "variables": "{\n  \"notificationIds\": [\"{{notificationId}}\"]\n}"
                  }
                },
                "url": {
                  "raw": "{{graphqlEndpoint}}",
                  "host": ["{{graphqlEndpoint}}"]
                },
                "description": "Permanently delete notifications. Cannot be undone."
              },
              "response": []
            },
            {
              "name": "5. Update Notification Preferences",
              "event": [
                {
                  "listen": "test",
                  "script": {
                    "exec": [
                      "var jsonData = pm.response.json();\n",
                      "if (jsonData.data && jsonData.data.updateNotificationPreferences) {\n",
                      "    var prefs = jsonData.data.updateNotificationPreferences;\n",
                      "    console.log('‚úì Notification preferences updated');\n",
                      "    ",
                      "    pm.test('Preferences updated successfully', function() {\n",
                      "        pm.expect(prefs.emailEnabled).to.be.false;\n",
                      "        pm.expect(prefs.pushEnabled).to.be.true;\n",
                      "        pm.expect(prefs.doNotDisturb).to.be.false;\n",
                      "    });\n",
                      "} else if (jsonData.errors) {\n",
                      "    console.error('‚ùå GraphQL errors:', jsonData.errors);\n",
                      "}"
                    ],
                    "type": "text/javascript",
                    "packages": {},
                    "requests": {}
                  }
                }
              ],
              "request": {
                "method": "POST",
                "header": [
                  {
                    "key": "Content-Type",
                    "value": "application/json"
                  },
                  {
                    "key": "Authorization",
                    "value": "Bearer {{token}}"
                  }
                ],
                "body": {
                  "mode": "graphql",
                  "graphql": {
                    "query": "mutation UpdateNotificationPreferences($input: UpdateNotificationPreferencesInput!) {\n  updateNotificationPreferences(input: $input) {\n    _id\n    enabled\n    emailEnabled\n    pushEnabled\n    smsEnabled\n    doNotDisturb\n    typePreferences {\n      type\n      channels\n      enabled\n    }\n  }\n}",
                    "variables": "{\n  \"input\": {\n    \"emailEnabled\": false,\n    \"pushEnabled\": true,\n    \"doNotDisturb\": false\n  }\n}"
                  }
                },
                "url": {
                  "raw": "{{graphqlEndpoint}}",
                  "host": ["{{graphqlEndpoint}}"]
                },
                "description": "Update notification preferences. All fields are optional. Only provided fields will be updated."
              },
              "response": []
            }
          ]
        },
        {
          "name": "Admin - Management",
          "item": [
            {
              "name": "1. Create Notification for User",
              "event": [
                {
                  "listen": "test",
                  "script": {
                    "exec": [
                      "var jsonData = pm.response.json();\n",
                      "if (jsonData.data && jsonData.data.createNotificationForUser) {\n",
                      "    var notification = jsonData.data.createNotificationForUser;\n",
                      "    console.log('‚úì Admin notification created:', notification._id);\n",
                      "    pm.environment.set('adminNotificationId', notification._id);\n",
                      "    ",
                      "    pm.test('Admin notification created successfully', function() {\n",
                      "        pm.expect(notification.title).to.eql('System Maintenance');\n",
                      "        pm.expect(notification.type).to.eql('SYSTEM');\n",
                      "        pm.expect(notification.priority).to.eql('HIGH');\n",
                      "    });\n",
                      "} else if (jsonData.errors) {\n",
                      "    console.error('‚ùå GraphQL errors:', jsonData.errors);\n",
                      "}"
                    ],
                    "type": "text/javascript",
                    "packages": {},
                    "requests": {}
                  }
                }
              ],
              "request": {
                "method": "POST",
                "header": [
                  {
                    "key": "Content-Type",
                    "value": "application/json"
                  },
                  {
                    "key": "Authorization",
                    "value": "Bearer {{token}}"
                  }
                ],
                "body": {
                  "mode": "graphql",
                  "graphql": {
                    "query": "mutation CreateNotificationForUser($userId: ID!, $input: CreateNotificationInput!) {\n  createNotificationForUser(userId: $userId, input: $input) {\n    _id\n    title\n    message\n    type\n    priority\n    channels\n    isRead\n    createdAt\n  }\n}",
                    "variables": "{\n  \"userId\": \"{{userId}}\",\n  \"input\": {\n    \"title\": \"System Maintenance\",\n    \"message\": \"Scheduled maintenance tonight at 2 AM UTC\",\n    \"type\": \"SYSTEM\",\n    \"priority\": \"HIGH\",\n    \"channels\": [\"IN_APP\", \"EMAIL\"],\n    \"actionUrl\": \"/maintenance\",\n    \"actionText\": \"Learn More\"\n  }\n}"
                  }
                },
                "url": {
                  "raw": "{{graphqlEndpoint}}",
                  "host": ["{{graphqlEndpoint}}"]
                },
                "description": "Admin: Create notification for specific user. Requires admin/super_admin role."
              },
              "response": []
            },
            {
              "name": "2. Send Bulk Notification",
              "event": [
                {
                  "listen": "test",
                  "script": {
                    "exec": [
                      "var jsonData = pm.response.json();\n",
                      "if (jsonData.data && jsonData.data.sendBulkNotification) {\n",
                      "    var result = jsonData.data.sendBulkNotification;\n",
                      "    console.log('‚úì Bulk notification sent');\n",
                      "    console.log('‚úì Success count:', result.successCount);\n",
                      "    console.log('‚úì Failure count:', result.failureCount);\n",
                      "    ",
                      "    pm.test('Bulk notification sent successfully', function() {\n",
                      "        pm.expect(result.success).to.be.true;\n",
                      "        pm.expect(result.successCount).to.be.a('number');\n",
                      "        pm.expect(result.failureCount).to.be.a('number');\n",
                      "    });\n",
                      "} else if (jsonData.errors) {\n",
                      "    console.error('‚ùå GraphQL errors:', jsonData.errors);\n",
                      "}"
                    ],
                    "type": "text/javascript",
                    "packages": {},
                    "requests": {}
                  }
                }
              ],
              "request": {
                "method": "POST",
                "header": [
                  {
                    "key": "Content-Type",
                    "value": "application/json"
                  },
                  {
                    "key": "Authorization",
                    "value": "Bearer {{token}}"
                  }
                ],
                "body": {
                  "mode": "graphql",
                  "graphql": {
                    "query": "mutation SendBulkNotification($input: BulkNotificationInput!) {\n  sendBulkNotification(input: $input) {\n    success\n    message\n    successCount\n    failureCount\n    errors\n  }\n}",
                    "variables": "{\n  \"input\": {\n    \"userIds\": [\"{{userId}}\"],\n    \"title\": \"Promotional Offer\",\n    \"message\": \"Get 20% off on all products this weekend!\",\n    \"type\": \"PROMOTIONAL\",\n    \"priority\": \"NORMAL\",\n    \"channels\": [\"EMAIL\", \"PUSH\"],\n    \"actionUrl\": \"/sale\",\n    \"actionText\": \"Shop Now\"\n  }\n}"
                  }
                },
                "url": {
                  "raw": "{{graphqlEndpoint}}",
                  "host": ["{{graphqlEndpoint}}"]
                },
                "description": "Admin: Send bulk notification to multiple users. Supports up to thousands of users."
              },
              "response": []
            }
          ]
        },
        {
          "name": "Real-time (WebSocket)",
          "item": [
            {
              "name": "1. Subscribe to New Notifications",
              "request": {
                "type": "websocket",
                "url": {
                  "raw": "ws://localhost:5000/notifications",
                  "protocol": "ws",
                  "host": ["localhost"],
                  "port": "5000",
                  "path": ["notifications"]
                },
                "auth": {
                  "type": "bearer",
                  "bearer": {
                    "token": "{{token}}"
                  }
                },
                "message": [
                  {
                    "type": "string",
                    "data": "{\"id\":\"1\",\"type\":\"start\",\"payload\":{\"query\":\"subscription { newNotification { _id title message type priority createdAt } }\"}}"
                  }
                ],
                "description": "WebSocket subscription for real-time notifications. Connect to notifications namespace and authenticate with Bearer token. Listens for new notifications."
              },
              "response": []
            },
            {
              "name": "2. Subscribe to Notification Updates",
              "request": {
                "type": "websocket",
                "url": {
                  "raw": "ws://localhost:5000/notifications",
                  "protocol": "ws",
                  "host": ["localhost"],
                  "port": "5000",
                  "path": ["notifications"]
                },
                "auth": {
                  "type": "bearer",
                  "bearer": {
                    "token": "{{token}}"
                  }
                },
                "message": [
                  {
                    "type": "string",
                    "data": "{\"id\":\"2\",\"type\":\"start\",\"payload\":{\"query\":\"subscription { notificationUpdated }\"}}"
                  }
                ],
                "description": "WebSocket subscription for notification update events (mark as read, archive, etc.)."
              },
              "response": []
            }
          ]
        }
      ],
      "description": "Complete notification system with GraphQL queries, mutations, and WebSocket subscriptions for real-time updates"
    },
    {
      "name": "üìÅ Storage - GraphQL",
      "item": [
        {
          "name": "1. Upload File (Avatar)",
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "var jsonData = pm.response.json();",
                  "",
                  "if (jsonData.data && jsonData.data.uploadFile && jsonData.data.uploadFile.file) {",
                  "    var fileId = jsonData.data.uploadFile.file._id;",
                  "    pm.environment.set('fileId', fileId);",
                  "    console.log('‚úì File uploaded:', fileId);",
                  "    console.log('‚úì File ID stored');",
                  "    ",
                  "    pm.test('File uploaded successfully', function() {",
                  "        pm.expect(jsonData.data.uploadFile.success).to.be.true;",
                  "        pm.expect(fileId).to.be.a('string');",
                  "        pm.expect(jsonData.data.uploadFile.file.url).to.include('http');",
                  "    });",
                  "} else if (jsonData.errors) {",
                  "    console.error('‚ùå GraphQL errors:', jsonData.errors);",
                  "}"
                ],
                "type": "text/javascript",
                "packages": {},
                "requests": {}
              }
            }
          ],
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              },
              {
                "key": "Authorization",
                "value": "Bearer {{token}}"
              },
              {
                "key": "apollo-require-preflight",
                "value": "true",
                "type": "text"
              }
            ],
            "body": {
              "mode": "formdata",
              "formdata": [
                {
                  "key": "operations",
                  "value": "{\"query\":\"mutation UploadFile($file: Upload!, $fileType: FileTypeEnum!, $relatedEntity: String, $relatedEntityId: String) { uploadFile(file: $file, fileType: $fileType, relatedEntity: $relatedEntity, relatedEntityId: $relatedEntityId) { success message file { _id originalName filename url mimetype size type status createdAt } } }\",\"variables\":{\"file\":null,\"fileType\":\"AVATAR\",\"relatedEntity\":\"user\",\"relatedEntityId\":\"{{userId}}\"}}",
                  "type": "text"
                },
                {
                  "key": "map",
                  "value": "{\"0\":[\"variables.file\"]}",
                  "type": "text"
                },
                {
                  "key": "0",
                  "type": "file",
                  "src": "postman-cloud:///1ef8704b-99da-44f0-90e4-10d4b24d90ad"
                }
              ]
            },
            "url": {
              "raw": "{{graphqlEndpoint}}",
              "host": ["{{graphqlEndpoint}}"]
            },
            "description": "Upload file via GraphQL (requires multipart form data). File will be queued for processing (optimization, variants)."
          },
          "response": []
        },
        {
          "name": "2. Get File by ID",
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "var jsonData = pm.response.json();",
                  "",
                  "if (jsonData.data && jsonData.data.file) {",
                  "    var file = jsonData.data.file;",
                  "    console.log('‚úì File retrieved:', file._id);",
                  "    ",
                  "    pm.test('File details retrieved', function() {",
                  "        pm.expect(file._id).to.eql(pm.environment.get('fileId'));",
                  "        pm.expect(file.status).to.be.oneOf(['PENDING', 'PROCESSING', 'COMPLETED', 'FAILED']);",
                  "        pm.expect(file.url).to.be.a('string');",
                  "        if (file.status === 'COMPLETED') {",
                  "            pm.expect(file.optimizedUrl).to.be.a('string');",
                  "        }",
                  "    });",
                  "}"
                ],
                "type": "text/javascript"
              }
            }
          ],
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              },
              {
                "key": "Authorization",
                "value": "Bearer {{token}}"
              }
            ],
            "body": {
              "mode": "graphql",
              "graphql": {
                "query": "query GetFile($id: ID!) {\n  file(id: $id) {\n    _id\n    originalName\n    filename\n    url\n    mimetype\n    size\n    type\n    status\n    optimizedUrl\n    optimizedSize\n    variants\n    metadata {\n      width\n      height\n      format\n      aspectRatio\n    }\n    isPublic\n    createdAt\n    updatedAt\n  }\n}",
                "variables": "{\n  \"id\": \"{{fileId}}\"\n}"
              }
            },
            "url": {
              "raw": "{{graphqlEndpoint}}",
              "host": ["{{graphqlEndpoint}}"]
            },
            "description": "Get file details by ID. Includes metadata, optimized versions, and variants if processing completed."
          },
          "response": []
        },
        {
          "name": "3. Get My Files (Paginated)",
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "var jsonData = pm.response.json();",
                  "",
                  "if (jsonData.data && jsonData.data.myFiles) {",
                  "    var paginatedFiles = jsonData.data.myFiles;",
                  "    console.log('‚úì Retrieved', paginatedFiles.files.length, 'files');",
                  "    console.log('‚úì Total files:', paginatedFiles.total);",
                  "    ",
                  "    pm.test('Paginated files retrieved', function() {",
                  "        pm.expect(paginatedFiles.files).to.be.an('array');",
                  "        pm.expect(paginatedFiles.total).to.be.a('number');",
                  "        pm.expect(paginatedFiles.page).to.eql(1);",
                  "        pm.expect(paginatedFiles.limit).to.eql(20);",
                  "        pm.expect(paginatedFiles.totalPages).to.be.a('number');",
                  "    });",
                  "}"
                ],
                "type": "text/javascript"
              }
            }
          ],
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              },
              {
                "key": "Authorization",
                "value": "Bearer {{token}}"
              }
            ],
            "body": {
              "mode": "graphql",
              "graphql": {
                "query": "query MyFiles($page: Float, $limit: Float) {\n  myFiles(page: $page, limit: $limit) {\n    files {\n      _id\n      originalName\n      filename\n      url\n      mimetype\n      size\n      type\n      status\n      optimizedUrl\n      createdAt\n    }\n    total\n    page\n    limit\n    totalPages\n  }\n}",
                "variables": "{\n  \"page\": 1,\n  \"limit\": 20\n}"
              }
            },
            "url": {
              "raw": "{{graphqlEndpoint}}",
              "host": ["{{graphqlEndpoint}}"]
            },
            "description": "Get paginated list of user's uploaded files. Default page=1, limit=20."
          },
          "response": []
        },
        {
          "name": "4. Delete File",
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "var jsonData = pm.response.json();",
                  "",
                  "if (jsonData.data && jsonData.data.deleteFile === true) {",
                  "    console.log('‚úì File deleted:', pm.environment.get('fileId'));",
                  "    ",
                  "    pm.test('File deleted successfully', function() {",
                  "        pm.expect(jsonData.data.deleteFile).to.be.true;",
                  "    });",
                  "    ",
                  "    pm.environment.unset('fileId');",
                  "} else if (jsonData.errors) {",
                  "    console.error('‚ùå GraphQL errors:', jsonData.errors);",
                  "}"
                ],
                "type": "text/javascript"
              }
            }
          ],
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              },
              {
                "key": "Authorization",
                "value": "Bearer {{token}}"
              }
            ],
            "body": {
              "mode": "graphql",
              "graphql": {
                "query": "mutation DeleteFile($id: ID!) {\n  deleteFile(id: $id)\n}",
                "variables": "{\n  \"id\": \"{{fileId}}\"\n}"
              }
            },
            "url": {
              "raw": "{{graphqlEndpoint}}",
              "host": ["{{graphqlEndpoint}}"]
            },
            "description": "Delete a file. File will be removed from disk and database record deleted."
          },
          "response": []
        }
      ],
      "description": "GraphQL file upload and management with automatic processing queue"
    },
    {
      "name": "üìÅ Storage - REST API",
      "item": [
        {
          "name": "1. Upload Avatar (REST)",
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "var jsonData = pm.response.json();",
                  "",
                  "if (jsonData.success && jsonData.file) {",
                  "    pm.environment.set('fileId', jsonData.file.id);",
                  "    console.log('‚úì Avatar uploaded:', jsonData.file.id);",
                  "    console.log('‚úì File ID stored');",
                  "    ",
                  "    pm.test('Avatar uploaded via REST', function() {",
                  "        pm.expect(jsonData.success).to.be.true;",
                  "        pm.expect(jsonData.file.id).to.be.a('string');",
                  "        pm.expect(jsonData.file.url).to.include('http');",
                  "        pm.response.to.have.status(201);",
                  "    });",
                  "}"
                ],
                "type": "text/javascript",
                "packages": {},
                "requests": {}
              }
            }
          ],
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Authorization",
                "value": "Bearer {{token}}"
              }
            ],
            "body": {
              "mode": "formdata",
              "formdata": [
                {
                  "key": "file",
                  "type": "file",
                  "src": "postman-cloud:///1ef8704b-99da-44f0-90e4-10d4b24d90ad"
                }
              ]
            },
            "url": {
              "raw": "{{baseUrl}}/storage/upload/avatar",
              "host": ["{{baseUrl}}"],
              "path": ["storage", "upload", "avatar"]
            },
            "description": "Upload avatar image via REST API (max 5MB, JPEG/PNG/WebP). Automatically queued for optimization and variant generation."
          },
          "response": []
        },
        {
          "name": "2. Upload Product Image (REST)",
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "var jsonData = pm.response.json();",
                  "",
                  "if (jsonData.success && jsonData.file) {",
                  "    console.log('‚úì Product image uploaded:', jsonData.file.id);",
                  "    ",
                  "    pm.test('Product image uploaded via REST', function() {",
                  "        pm.expect(jsonData.success).to.be.true;",
                  "        pm.expect(jsonData.file.id).to.be.a('string');",
                  "        pm.expect(jsonData.file.optimizedUrl).to.be.a('string');",
                  "        pm.expect(jsonData.file.variants).to.be.an('array');",
                  "        pm.response.to.have.status(201);",
                  "    });",
                  "}"
                ],
                "type": "text/javascript",
                "packages": {},
                "requests": {}
              }
            }
          ],
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Authorization",
                "value": "Bearer {{token}}"
              }
            ],
            "body": {
              "mode": "formdata",
              "formdata": [
                {
                  "key": "file",
                  "type": "file",
                  "src": "postman-cloud:///1ef8704b-99da-44f0-90e4-10d4b24d90ad"
                },
                {
                  "key": "productId",
                  "value": "product_123",
                  "type": "text"
                }
              ]
            },
            "url": {
              "raw": "{{baseUrl}}/storage/upload/product",
              "host": ["{{baseUrl}}"],
              "path": ["storage", "upload", "product"]
            },
            "description": "Upload product image (max 10MB, auto-generates variants: thumbnail, small, medium, large). Requires productId."
          },
          "response": []
        },
        {
          "name": "3. Upload Document (REST)",
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "var jsonData = pm.response.json();",
                  "",
                  "if (jsonData.success && jsonData.file) {",
                  "    console.log('‚úì Document uploaded:', jsonData.file.id);",
                  "    ",
                  "    pm.test('Document uploaded via REST', function() {",
                  "        pm.expect(jsonData.success).to.be.true;",
                  "        pm.expect(jsonData.file.id).to.be.a('string');",
                  "        pm.expect(jsonData.file.filename).to.match(/\\.(pdf|doc|docx)$/);",
                  "        pm.response.to.have.status(201);",
                  "    });",
                  "}"
                ],
                "type": "text/javascript",
                "packages": {},
                "requests": {}
              }
            }
          ],
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Authorization",
                "value": "Bearer {{token}}"
              }
            ],
            "body": {
              "mode": "formdata",
              "formdata": [
                {
                  "key": "file",
                  "type": "file",
                  "src": "postman-cloud:///1f0d559d-3316-4240-8eae-8d1aad096757"
                }
              ]
            },
            "url": {
              "raw": "{{baseUrl}}/storage/upload/document",
              "host": ["{{baseUrl}}"],
              "path": ["storage", "upload", "document"]
            },
            "description": "Upload document (PDF, DOC, DOCX - max 20MB). Marked as private by default."
          },
          "response": []
        },
        {
          "name": "4. Get File by ID (REST)",
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "pm.test('File retrieved via REST', function() {",
                  "    pm.response.to.have.status(200);",
                  "});",
                  "",
                  "var jsonData = pm.response.json();",
                  "if (jsonData._id) {",
                  "    console.log('‚úì File retrieved via REST:', jsonData._id);",
                  "    ",
                  "    pm.test('File structure correct', function() {",
                  "        pm.expect(jsonData._id).to.be.a('string');",
                  "        pm.expect(jsonData.originalName).to.be.a('string');",
                  "        pm.expect(jsonData.url).to.include('http');",
                  "    });",
                  "}"
                ],
                "type": "text/javascript"
              }
            }
          ],
          "request": {
            "method": "GET",
            "header": [
              {
                "key": "Authorization",
                "value": "Bearer {{token}}"
              }
            ],
            "url": {
              "raw": "{{baseUrl}}/storage/file/{{fileId}}",
              "host": ["{{baseUrl}}"],
              "path": ["storage", "file", "{{fileId}}"]
            },
            "description": "Get file details by ID via REST API. Returns full file object with metadata."
          },
          "response": []
        },
        {
          "name": "5. Get My Files (REST)",
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "pm.test('Files retrieved via REST', function() {",
                  "    pm.response.to.have.status(200);",
                  "});",
                  "",
                  "var jsonData = pm.response.json();",
                  "if (Array.isArray(jsonData)) {",
                  "    console.log('‚úì Retrieved', jsonData.length, 'files via REST');",
                  "    ",
                  "    pm.test('Files array structure', function() {",
                  "        pm.expect(jsonData).to.be.an('array');",
                  "        if (jsonData.length > 0) {",
                  "            pm.expect(jsonData[0]._id).to.be.a('string');",
                  "        }",
                  "    });",
                  "}"
                ],
                "type": "text/javascript"
              }
            }
          ],
          "request": {
            "method": "GET",
            "header": [
              {
                "key": "Authorization",
                "value": "Bearer {{token}}"
              }
            ],
            "url": {
              "raw": "{{baseUrl}}/storage/my-files",
              "host": ["{{baseUrl}}"],
              "path": ["storage", "my-files"]
            },
            "description": "Get all files uploaded by current user via REST API. Returns array of file objects."
          },
          "response": []
        },
        {
          "name": "6. Delete File (REST)",
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "pm.test('File deleted via REST', function() {",
                  "    pm.response.to.have.status(200);",
                  "});",
                  "",
                  "var jsonData = pm.response.json();",
                  "if (jsonData.success) {",
                  "    console.log('‚úì File deleted via REST:', pm.environment.get('fileId'));",
                  "    pm.environment.unset('fileId');",
                  "    ",
                  "    pm.test('Delete response structure', function() {",
                  "        pm.expect(jsonData.success).to.be.true;",
                  "        pm.expect(jsonData.message).to.include('deleted');",
                  "    });",
                  "}"
                ],
                "type": "text/javascript"
              }
            }
          ],
          "request": {
            "method": "DELETE",
            "header": [
              {
                "key": "Authorization",
                "value": "Bearer {{token}}"
              }
            ],
            "url": {
              "raw": "{{baseUrl}}/storage/file/{{fileId}}",
              "host": ["{{baseUrl}}"],
              "path": ["storage", "file", "{{fileId}}"]
            },
            "description": "Delete a file via REST API. Removes file from disk and database. User must be the owner."
          },
          "response": []
        }
      ],
      "description": "REST API file upload endpoints with multipart/form-data support"
    },
    {
      "name": "üëë Admin - Users Management",
      "item": [
        {
          "name": "1. Get All Users (Paginated)",
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "var jsonData = pm.response.json();",
                  "",
                  "if (jsonData.data && jsonData.data.users) {",
                  "    var result = jsonData.data.users;",
                  "    console.log('‚úì Retrieved', result.users.length, 'users');",
                  "    console.log('‚úì Total users:', result.total);",
                  "    ",
                  "    pm.test('Users paginated response', function() {",
                  "        pm.expect(result.users).to.be.an('array');",
                  "        pm.expect(result.total).to.be.a('number');",
                  "        pm.expect(result.page).to.eql(1);",
                  "        pm.expect(result.limit).to.eql(10);",
                  "        pm.expect(result.totalPages).to.be.a('number');",
                  "    });",
                  "}"
                ],
                "type": "text/javascript"
              }
            }
          ],
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              },
              {
                "key": "Authorization",
                "value": "Bearer {{token}}"
              }
            ],
            "body": {
              "mode": "graphql",
              "graphql": {
                "query": "query GetUsers($filters: UsersFilterInput) {\n  users(filters: $filters) {\n    users {\n      _id\n      firstName\n      lastName\n      email\n      role\n      status\n      isEmailVerified\n      isActive\n      lastLogin\n      loginAttempts\n      lockUntil\n      createdAt\n    }\n    total\n    page\n    limit\n    totalPages\n  }\n}",
                "variables": "{\n  \"filters\": {\n    \"page\": 1,\n    \"limit\": 10\n  }\n}"
              }
            },
            "url": {
              "raw": "{{graphqlEndpoint}}",
              "host": ["{{graphqlEndpoint}}"]
            },
            "description": "Get paginated list of all users (Admin only). Includes sensitive fields like loginAttempts, lockUntil."
          },
          "response": []
        },
        {
          "name": "2. Get Users - Filter by Role",
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "var jsonData = pm.response.json();",
                  "",
                  "if (jsonData.data && jsonData.data.users) {",
                  "    var users = jsonData.data.users.users;",
                  "    console.log('‚úì Retrieved', users.length, 'customers');",
                  "    ",
                  "    pm.test('Users filtered by role', function() {",
                  "        users.forEach(user => {",
                  "            pm.expect(user.role).to.eql('customer');",
                  "        });",
                  "    });",
                  "}"
                ],
                "type": "text/javascript"
              }
            }
          ],
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              },
              {
                "key": "Authorization",
                "value": "Bearer {{token}}"
              }
            ],
            "body": {
              "mode": "graphql",
              "graphql": {
                "query": "query GetUsers($filters: UsersFilterInput) {\n  users(filters: $filters) {\n    users {\n      _id\n      firstName\n      lastName\n      email\n      role\n      status\n    }\n    total\n  }\n}",
                "variables": "{\n  \"filters\": {\n    \"role\": \"customer\",\n    \"page\": 1,\n    \"limit\": 10\n  }\n}"
              }
            },
            "url": {
              "raw": "{{graphqlEndpoint}}",
              "host": ["{{graphqlEndpoint}}"]
            },
            "description": "Filter users by role (customer, admin, super_admin, vendor, moderator, support)"
          },
          "response": []
        },
        {
          "name": "3. Get Users - Filter by Status",
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "var jsonData = pm.response.json();",
                  "",
                  "if (jsonData.data && jsonData.data.users) {",
                  "    var users = jsonData.data.users.users;",
                  "    console.log('‚úì Retrieved', users.length, 'banned users');",
                  "    ",
                  "    pm.test('Users filtered by status', function() {",
                  "        users.forEach(user => {",
                  "            pm.expect(user.status).to.eql('banned');",
                  "            pm.expect(user.banReason).to.be.a('string');",
                  "        });",
                  "    });",
                  "}"
                ],
                "type": "text/javascript"
              }
            }
          ],
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              },
              {
                "key": "Authorization",
                "value": "Bearer {{token}}"
              }
            ],
            "body": {
              "mode": "graphql",
              "graphql": {
                "query": "query GetUsers($filters: UsersFilterInput) {\n  users(filters: $filters) {\n    users {\n      _id\n      firstName\n      lastName\n      email\n      status\n      banReason\n    }\n    total\n  }\n}",
                "variables": "{\n  \"filters\": {\n    \"status\": \"banned\",\n    \"page\": 1,\n    \"limit\": 10\n  }\n}"
              }
            },
            "url": {
              "raw": "{{graphqlEndpoint}}",
              "host": ["{{graphqlEndpoint}}"]
            },
            "description": "Filter users by status (active, inactive, banned, pending, suspended)"
          },
          "response": []
        },
        {
          "name": "4. Get Users - Search",
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "var jsonData = pm.response.json();",
                  "",
                  "if (jsonData.data && jsonData.data.users) {",
                  "    var result = jsonData.data.users;",
                  "    console.log('‚úì Found', result.total, 'users matching search');",
                  "    ",
                  "    pm.test('Search results returned', function() {",
                  "        pm.expect(result.total).to.be.a('number');",
                  "        pm.expect(result.users).to.be.an('array');",
                  "    });",
                  "}"
                ],
                "type": "text/javascript"
              }
            }
          ],
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              },
              {
                "key": "Authorization",
                "value": "Bearer {{token}}"
              }
            ],
            "body": {
              "mode": "graphql",
              "graphql": {
                "query": "query GetUsers($filters: UsersFilterInput) {\n  users(filters: $filters) {\n    users {\n      _id\n      firstName\n      lastName\n      email\n      role\n    }\n    total\n  }\n}",
                "variables": "{\n  \"filters\": {\n    \"search\": \"john\",\n    \"page\": 1,\n    \"limit\": 10\n  }\n}"
              }
            },
            "url": {
              "raw": "{{graphqlEndpoint}}",
              "host": ["{{graphqlEndpoint}}"]
            },
            "description": "Search users by name, email, or username. Uses MongoDB text index for efficient searching."
          },
          "response": []
        },
        {
          "name": "5. Get Users - Filter Email Verified",
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "var jsonData = pm.response.json();",
                  "",
                  "if (jsonData.data && jsonData.data.users) {",
                  "    var users = jsonData.data.users.users;",
                  "    console.log('‚úì Found', users.length, 'unverified users');",
                  "    ",
                  "    pm.test('Email verification filter applied', function() {",
                  "        users.forEach(user => {",
                  "            pm.expect(user.isEmailVerified).to.be.false;",
                  "        });",
                  "    });",
                  "}"
                ],
                "type": "text/javascript"
              }
            }
          ],
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              },
              {
                "key": "Authorization",
                "value": "Bearer {{token}}"
              }
            ],
            "body": {
              "mode": "graphql",
              "graphql": {
                "query": "query GetUsers($filters: UsersFilterInput) {\n  users(filters: $filters) {\n    users {\n      _id\n      email\n      isEmailVerified\n    }\n    total\n  }\n}",
                "variables": "{\n  \"filters\": {\n    \"isEmailVerified\": false,\n    \"page\": 1,\n    \"limit\": 10\n  }\n}"
              }
            },
            "url": {
              "raw": "{{graphqlEndpoint}}",
              "host": ["{{graphqlEndpoint}}"]
            },
            "description": "Filter by email verification status. Useful for finding pending verifications."
          },
          "response": []
        },
        {
          "name": "6. Get User Admin Details",
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "var jsonData = pm.response.json();",
                  "",
                  "if (jsonData.data && jsonData.data.userAdmin) {",
                  "    var user = jsonData.data.userAdmin;",
                  "    console.log('‚úì Retrieved admin details for:', user.email);",
                  "    ",
                  "    pm.test('Admin details include sensitive data', function() {",
                  "        pm.expect(user.loginAttempts).to.be.a('number');",
                  "        pm.expect(user.banReason).to.be.oneOf(['string', 'undefined', 'null']);",
                  "        pm.expect(user.refreshTokens).to.be.undefined;\n",
                  "    });",
                  "}"
                ],
                "type": "text/javascript"
              }
            }
          ],
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              },
              {
                "key": "Authorization",
                "value": "Bearer {{token}}"
              }
            ],
            "body": {
              "mode": "graphql",
              "graphql": {
                "query": "query GetUserAdmin($id: ID!) {\n  userAdmin(id: $id) {\n    _id\n    firstName\n    lastName\n    email\n    role\n    status\n    isEmailVerified\n    phone\n    phoneVerified\n    lastLogin\n    isActive\n    loginAttempts\n    lockUntil\n    banReason\n    bannedAt\n    bannedBy\n    addresses {\n      _id\n      address\n      city\n      country\n    }\n    createdAt\n    updatedAt\n  }\n}",
                "variables": "{\n  \"id\": \"{{userId}}\"\n}"
              }
            },
            "url": {
              "raw": "{{graphqlEndpoint}}",
              "host": ["{{graphqlEndpoint}}"]
            },
            "description": "Get detailed user information including sensitive data like loginAttempts, lockUntil, and ban details."
          },
          "response": []
        },
        {
          "name": "7. Update User Role",
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "var jsonData = pm.response.json();",
                  "",
                  "if (jsonData.data && jsonData.data.updateUserRole) {",
                  "    var user = jsonData.data.updateUserRole;",
                  "    console.log('‚úì User role updated to:', user.role);",
                  "    ",
                  "    pm.test('Role updated successfully', function() {",
                  "        pm.expect(user.role).to.eql('admin');",
                  "        pm.expect(user.updatedAt).to.be.a('string');",
                  "    });",
                  "}"
                ],
                "type": "text/javascript"
              }
            }
          ],
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              },
              {
                "key": "Authorization",
                "value": "Bearer {{token}}"
              }
            ],
            "body": {
              "mode": "graphql",
              "graphql": {
                "query": "mutation UpdateUserRole($input: UpdateUserRoleInput!) {\n  updateUserRole(input: $input) {\n    _id\n    firstName\n    lastName\n    email\n    role\n    updatedAt\n  }\n}",
                "variables": "{\n  \"input\": {\n    \"userId\": \"{{userId}}\",\n    \"role\": \"admin\"\n  }\n}"
              }
            },
            "url": {
              "raw": "{{graphqlEndpoint}}",
              "host": ["{{graphqlEndpoint}}"]
            },
            "description": "Change user role (customer, admin, vendor, moderator, support). Super Admin can promote to super_admin."
          },
          "response": []
        },
        {
          "name": "8. Update User Status",
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "var jsonData = pm.response.json();",
                  "",
                  "if (jsonData.data && jsonData.data.updateUserStatus) {",
                  "    var user = jsonData.data.updateUserStatus;",
                  "    console.log('‚úì User status updated to:', user.status);",
                  "    ",
                  "    pm.test('Status updated successfully', function() {",
                  "        pm.expect(user.status).to.eql('active');",
                  "    });",
                  "}"
                ],
                "type": "text/javascript"
              }
            }
          ],
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              },
              {
                "key": "Authorization",
                "value": "Bearer {{token}}"
              }
            ],
            "body": {
              "mode": "graphql",
              "graphql": {
                "query": "mutation UpdateUserStatus($input: UpdateUserStatusInput!) {\n  updateUserStatus(input: $input) {\n    _id\n    firstName\n    lastName\n    email\n    status\n    updatedAt\n  }\n}",
                "variables": "{\n  \"input\": {\n    \"userId\": \"{{userId}}\",\n    \"status\": \"active\"\n  }\n}"
              }
            },
            "url": {
              "raw": "{{graphqlEndpoint}}",
              "host": ["{{graphqlEndpoint}}"]
            },
            "description": "Change user status (active, inactive, banned, pending, suspended). Used for account management."
          },
          "response": []
        },
        {
          "name": "9. Ban User",
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "var jsonData = pm.response.json();",
                  "",
                  "if (jsonData.data && jsonData.data.banUser) {",
                  "    var user = jsonData.data.banUser;",
                  "    console.log('‚úì User banned:', user._id);",
                  "    console.log('‚úì Ban reason:', user.banReason);",
                  "    ",
                  "    pm.test('User banned successfully', function() {",
                  "        pm.expect(user.status).to.eql('banned');",
                  "        pm.expect(user.banReason).to.include('spam');",
                  "        pm.expect(user.bannedAt).to.be.a('string');",
                  "        pm.expect(user.bannedBy).to.be.a('string');",
                  "    });",
                  "}"
                ],
                "type": "text/javascript"
              }
            }
          ],
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              },
              {
                "key": "Authorization",
                "value": "Bearer {{token}}"
              }
            ],
            "body": {
              "mode": "graphql",
              "graphql": {
                "query": "mutation BanUser($input: BanUserInput!) {\n  banUser(input: $input) {\n    _id\n    firstName\n    lastName\n    email\n    status\n    banReason\n    bannedAt\n    bannedBy\n  }\n}",
                "variables": "{\n  \"input\": {\n    \"userId\": \"{{userId}}\",\n    \"reason\": \"Violation of terms of service - spam activity detected in multiple listings\"\n  }\n}"
              }
            },
            "url": {
              "raw": "{{graphqlEndpoint}}",
              "host": ["{{graphqlEndpoint}}"]
            },
            "description": "Ban user with reason (audit logged). User cannot login while banned. Ban record includes admin ID."
          },
          "response": []
        },
        {
          "name": "10. Unban User",
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "var jsonData = pm.response.json();",
                  "",
                  "if (jsonData.data && jsonData.data.unbanUser) {",
                  "    var user = jsonData.data.unbanUser;",
                  "    console.log('‚úì User unbanned:', user._id);",
                  "    ",
                  "    pm.test('User unbanned successfully', function() {",
                  "        pm.expect(user.status).to.eql('active');",
                  "        pm.expect(user.banReason).to.be.null;",
                  "        pm.expect(user.bannedAt).to.be.null;",
                  "    });",
                  "}"
                ],
                "type": "text/javascript"
              }
            }
          ],
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              },
              {
                "key": "Authorization",
                "value": "Bearer {{token}}"
              }
            ],
            "body": {
              "mode": "graphql",
              "graphql": {
                "query": "mutation UnbanUser($userId: ID!) {\n  unbanUser(userId: $userId) {\n    _id\n    firstName\n    lastName\n    email\n    status\n    banReason\n    bannedAt\n  }\n}",
                "variables": "{\n  \"userId\": \"{{userId}}\"\n}"
              }
            },
            "url": {
              "raw": "{{graphqlEndpoint}}",
              "host": ["{{graphqlEndpoint}}"]
            },
            "description": "Remove ban from user. Restores account to active status and clears ban history."
          },
          "response": []
        },
        {
          "name": "11. Promote to Super Admin",
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "var jsonData = pm.response.json();",
                  "",
                  "if (jsonData.data && jsonData.data.promoteToSuperAdmin) {",
                  "    var user = jsonData.data.promoteToSuperAdmin;",
                  "    console.log('‚úì User promoted to super_admin:', user._id);",
                  "    ",
                  "    pm.test('Promotion to Super Admin successful', function() {",
                  "        pm.expect(user.role).to.eql('super_admin');",
                  "    });",
                  "}"
                ],
                "type": "text/javascript"
              }
            }
          ],
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              },
              {
                "key": "Authorization",
                "value": "Bearer {{token}}"
              }
            ],
            "body": {
              "mode": "graphql",
              "graphql": {
                "query": "mutation PromoteToSuperAdmin($userId: ID!) {\n  promoteToSuperAdmin(userId: $userId) {\n    _id\n    firstName\n    lastName\n    email\n    role\n    updatedAt\n  }\n}",
                "variables": "{\n  \"userId\": \"{{userId}}\"\n}"
              }
            },
            "url": {
              "raw": "{{graphqlEndpoint}}",
              "host": ["{{graphqlEndpoint}}"]
            },
            "description": "Promote user to super admin (Super Admin only). Gives highest privileges in the system."
          },
          "response": []
        }
      ],
      "description": "Admin-only user management endpoints with filtering, banning, and role management"
    },
    {
      "name": "üëë Admin - Queue Management",
      "item": [
        {
          "name": "1. Email Queue Stats",
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "pm.test('Email queue stats retrieved', function() {",
                  "    pm.response.to.have.status(200);",
                  "});",
                  "",
                  "var jsonData = pm.response.json();",
                  "console.log('Email queue - Waiting:', jsonData.waiting);",
                  "console.log('Email queue - Active:', jsonData.active);",
                  "console.log('Email queue - Completed:', jsonData.completed);",
                  "console.log('Email queue - Failed:', jsonData.failed);",
                  "console.log('Email queue - Delayed:', jsonData.delayed);",
                  "",
                  "pm.test('Queue stats structure', function() {",
                  "    pm.expect(jsonData.waiting).to.be.a('number');",
                  "    pm.expect(jsonData.active).to.be.a('number');",
                  "    pm.expect(jsonData.completed).to.be.a('number');",
                  "    pm.expect(jsonData.failed).to.be.a('number');",
                  "    pm.expect(jsonData.total).to.be.a('number');",
                  "});"
                ],
                "type": "text/javascript"
              }
            }
          ],
          "request": {
            "method": "GET",
            "header": [
              {
                "key": "Authorization",
                "value": "Bearer {{token}}"
              }
            ],
            "url": {
              "raw": "{{baseUrl}}/admin/email-queue/stats",
              "host": ["{{baseUrl}}"],
              "path": ["admin", "email-queue", "stats"]
            },
            "description": "Get email queue statistics including waiting, active, completed, failed, and delayed job counts."
          },
          "response": []
        },
        {
          "name": "2. Email Queue Failed Jobs",
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "pm.test('Failed email jobs retrieved', function() {",
                  "    pm.response.to.have.status(200);",
                  "});",
                  "",
                  "var jsonData = pm.response.json();",
                  "console.log('‚úì Found', jsonData.length, 'failed email jobs');",
                  "",
                  "if (jsonData.length > 0) {",
                  "    pm.environment.set('jobId', jsonData[0].id);",
                  "    console.log('‚úì Stored first failed job ID:', jsonData[0].id);",
                  "}",
                  "",
                  "pm.test('Failed jobs array', function() {",
                  "    pm.expect(jsonData).to.be.an('array');",
                  "});"
                ],
                "type": "text/javascript"
              }
            }
          ],
          "request": {
            "method": "GET",
            "header": [
              {
                "key": "Authorization",
                "value": "Bearer {{token}}"
              }
            ],
            "url": {
              "raw": "{{baseUrl}}/admin/email-queue/failed",
              "host": ["{{baseUrl}}"],
              "path": ["admin", "email-queue", "failed"]
            },
            "description": "Get failed email jobs with details: id, data, failedReason, attemptsMade, timestamp."
          },
          "response": []
        },
        {
          "name": "3. Retry Email Job",
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "pm.test('Email job retry triggered', function() {",
                  "    pm.response.to.have.status(200);",
                  "});",
                  "",
                  "var jsonData = pm.response.json();",
                  "if (jsonData.success) {",
                  "    console.log('‚úì Job queued for retry:', pm.environment.get('jobId'));",
                  "    pm.test('Retry response', function() {",
                  "        pm.expect(jsonData.success).to.be.true;",
                  "        pm.expect(jsonData.message).to.include('queued for retry');",
                  "    });",
                  "}"
                ],
                "type": "text/javascript"
              }
            }
          ],
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Authorization",
                "value": "Bearer {{token}}"
              }
            ],
            "url": {
              "raw": "{{baseUrl}}/admin/email-queue/retry/{{jobId}}",
              "host": ["{{baseUrl}}"],
              "path": ["admin", "email-queue", "retry", "{{jobId}}"]
            },
            "description": "Retry a specific failed email job. Job ID can be obtained from failed jobs endpoint."
          },
          "response": []
        },
        {
          "name": "4. Retry All Failed Email Jobs",
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "pm.test('All failed email jobs retry triggered', function() {",
                  "    pm.response.to.have.status(200);",
                  "});",
                  "",
                  "var jsonData = pm.response.json();",
                  "if (jsonData.success) {",
                  "    console.log('‚úì All failed jobs queued for retry');",
                  "    pm.test('Retry all response', function() {",
                  "        pm.expect(jsonData.success).to.be.true;",
                  "        pm.expect(jsonData.message).to.include('All failed jobs');",
                  "    });",
                  "}"
                ],
                "type": "text/javascript"
              }
            }
          ],
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Authorization",
                "value": "Bearer {{token}}"
              }
            ],
            "url": {
              "raw": "{{baseUrl}}/admin/email-queue/retry-all",
              "host": ["{{baseUrl}}"],
              "path": ["admin", "email-queue", "retry-all"]
            },
            "description": "Retry all failed email jobs. Useful after fixing SMTP configuration issues."
          },
          "response": []
        },
        {
          "name": "5. Clean Email Queue",
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "pm.test('Email queue cleaned', function() {",
                  "    pm.response.to.have.status(200);",
                  "});",
                  "",
                  "var jsonData = pm.response.json();",
                  "if (jsonData.success) {",
                  "    console.log('‚úì Old completed/failed jobs cleaned');",
                  "    pm.test('Clean response', function() {",
                  "        pm.expect(jsonData.success).to.be.true;",
                  "        pm.expect(jsonData.message).to.include('cleaned');",
                  "    });",
                  "}"
                ],
                "type": "text/javascript"
              }
            }
          ],
          "request": {
            "method": "DELETE",
            "header": [
              {
                "key": "Authorization",
                "value": "Bearer {{token}}"
              }
            ],
            "url": {
              "raw": "{{baseUrl}}/admin/email-queue/clean",
              "host": ["{{baseUrl}}"],
              "path": ["admin", "email-queue", "clean"]
            },
            "description": "Clean old completed/failed email jobs. Removes jobs older than 24 hours by default."
          },
          "response": []
        },
        {
          "name": "6. Pause Email Queue",
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "pm.test('Email queue paused', function() {",
                  "    pm.response.to.have.status(200);",
                  "});",
                  "",
                  "var jsonData = pm.response.json();",
                  "if (jsonData.success) {",
                  "    console.log('‚úì Email queue paused');",
                  "    pm.test('Pause response', function() {",
                  "        pm.expect(jsonData.success).to.be.true;",
                  "        pm.expect(jsonData.message).to.include('paused');",
                  "    });",
                  "}"
                ],
                "type": "text/javascript"
              }
            }
          ],
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Authorization",
                "value": "Bearer {{token}}"
              }
            ],
            "url": {
              "raw": "{{baseUrl}}/admin/email-queue/pause",
              "host": ["{{baseUrl}}"],
              "path": ["admin", "email-queue", "pause"]
            },
            "description": "Pause email queue processing. New jobs will be added but not processed until resumed."
          },
          "response": []
        },
        {
          "name": "7. Resume Email Queue",
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "pm.test('Email queue resumed', function() {",
                  "    pm.response.to.have.status(200);",
                  "});",
                  "",
                  "var jsonData = pm.response.json();",
                  "if (jsonData.success) {",
                  "    console.log('‚úì Email queue resumed');",
                  "    pm.test('Resume response', function() {",
                  "        pm.expect(jsonData.success).to.be.true;",
                  "        pm.expect(jsonData.message).to.include('resumed');",
                  "    });",
                  "}"
                ],
                "type": "text/javascript"
              }
            }
          ],
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Authorization",
                "value": "Bearer {{token}}"
              }
            ],
            "url": {
              "raw": "{{baseUrl}}/admin/email-queue/resume",
              "host": ["{{baseUrl}}"],
              "path": ["admin", "email-queue", "resume"]
            },
            "description": "Resume email queue processing. Starts processing waiting jobs."
          },
          "response": []
        },
        {
          "name": "8. Storage Queue Stats",
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "pm.test('Storage queue stats retrieved', function() {",
                  "    pm.response.to.have.status(200);",
                  "});",
                  "",
                  "var jsonData = pm.response.json();",
                  "console.log('Storage queue - Waiting:', jsonData.waiting);",
                  "console.log('Storage queue - Active:', jsonData.active);",
                  "console.log('Storage queue - Completed:', jsonData.completed);",
                  "console.log('Storage queue - Failed:', jsonData.failed);",
                  "",
                  "pm.test('Storage queue stats structure', function() {",
                  "    pm.expect(jsonData.waiting).to.be.a('number');",
                  "    pm.expect(jsonData.active).to.be.a('number');",
                  "    pm.expect(jsonData.completed).to.be.a('number');",
                  "    pm.expect(jsonData.failed).to.be.a('number');",
                  "});"
                ],
                "type": "text/javascript"
              }
            }
          ],
          "request": {
            "method": "GET",
            "header": [
              {
                "key": "Authorization",
                "value": "Bearer {{token}}"
              }
            ],
            "url": {
              "raw": "{{baseUrl}}/admin/storage-queue/stats",
              "host": ["{{baseUrl}}"],
              "path": ["admin", "storage-queue", "stats"]
            },
            "description": "Get storage queue statistics for file processing (optimization, variant generation)."
          },
          "response": []
        },
        {
          "name": "9. Storage Queue Failed Jobs",
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "pm.test('Failed storage jobs retrieved', function() {",
                  "    pm.response.to.have.status(200);",
                  "});",
                  "",
                  "var jsonData = pm.response.json();",
                  "console.log('‚úì Found', jsonData.length, 'failed storage jobs');"
                ],
                "type": "text/javascript"
              }
            }
          ],
          "request": {
            "method": "GET",
            "header": [
              {
                "key": "Authorization",
                "value": "Bearer {{token}}"
              }
            ],
            "url": {
              "raw": "{{baseUrl}}/admin/storage-queue/failed",
              "host": ["{{baseUrl}}"],
              "path": ["admin", "storage-queue", "failed"]
            },
            "description": "Get failed storage jobs (image processing, optimization failures)."
          },
          "response": []
        },
        {
          "name": "10. Cleanup Expired Files",
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "pm.test('Expired files cleanup triggered', function() {",
                  "    pm.response.to.have.status(200);",
                  "});",
                  "",
                  "var jsonData = pm.response.json();",
                  "if (jsonData.success) {",
                  "    console.log('‚úì Cleanup job queued');",
                  "    pm.test('Cleanup response', function() {",
                  "        pm.expect(jsonData.success).to.be.true;",
                  "    });",
                  "}"
                ],
                "type": "text/javascript"
              }
            }
          ],
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Authorization",
                "value": "Bearer {{token}}"
              }
            ],
            "url": {
              "raw": "{{baseUrl}}/admin/storage-queue/cleanup-expired",
              "host": ["{{baseUrl}}"],
              "path": ["admin", "storage-queue", "cleanup-expired"]
            },
            "description": "Trigger cleanup of expired files (files with expiresAt < now)."
          },
          "response": []
        }
      ],
      "description": "Admin queue management endpoints for monitoring and controlling background job processing"
    },
    {
      "name": "üß™ Testing - Rate Limiting",
      "item": [
        {
          "name": "1. Test Login Rate Limit (5/min)",
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "var jsonData = pm.response.json();",
                  "",
                  "if (jsonData.errors) {",
                  "    if (iteration === 6) {",
                  "        pm.test('Login rate limit triggered', function() {",
                  "            pm.expect(jsonData.errors[0].message).to.include('Too many requests');",
                  "            pm.response.to.have.status(429);",
                  "        });",
                  "    }",
                  "}"
                ],
                "type": "text/javascript"
              }
            }
          ],
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "body": {
              "mode": "graphql",
              "graphql": {
                "query": "mutation Login($input: LoginInput!) {\n  login(input: $input) {\n    accessToken\n  }\n}",
                "variables": "{\n  \"input\": {\n    \"email\": \"{{testEmail}}\",\n    \"password\": \"WrongPassword123!\"\n  }\n}"
              }
            },
            "url": {
              "raw": "{{graphqlEndpoint}}",
              "host": ["{{graphqlEndpoint}}"]
            },
            "description": "Run 6 times quickly to trigger rate limit. 5 attempts allowed per minute."
          },
          "response": []
        },
        {
          "name": "2. Test Registration Rate Limit (3/min)",
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "var jsonData = pm.response.json();",
                  "",
                  "if (jsonData.errors) {",
                  "    if (iteration === 4) {",
                  "        pm.test('Registration rate limit triggered', function() {",
                  "            pm.expect(jsonData.errors[0].message).to.include('Too many requests');",
                  "            pm.response.to.have.status(429);",
                  "        });",
                  "    }",
                  "}"
                ],
                "type": "text/javascript"
              }
            }
          ],
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "body": {
              "mode": "graphql",
              "graphql": {
                "query": "mutation Register($input: RegisterInput!) {\n  register(input: $input) {\n    success\n    email\n  }\n}",
                "variables": "{\n  \"input\": {\n    \"firstName\": \"Test\",\n    \"lastName\": \"User\",\n    \"email\": \"test{{$randomInt}}@example.com\",\n    \"password\": \"{{testPassword}}\"\n  }\n}"
              }
            },
            "url": {
              "raw": "{{graphqlEndpoint}}",
              "host": ["{{graphqlEndpoint}}"]
            },
            "description": "Run 4 times quickly to trigger rate limit. 3 registrations allowed per minute."
          },
          "response": []
        },
        {
          "name": "3. Test Resend OTP Rate Limit (3/min + 1min wait)",
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "var jsonData = pm.response.json();",
                  "",
                  "if (jsonData.errors) {",
                  "    pm.test('Resend OTP rate limit triggered', function() {",
                  "        pm.expect(jsonData.errors[0].message).to.include('wait at least 1 minute');",
                  "    });",
                  "}"
                ],
                "type": "text/javascript"
              }
            }
          ],
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "body": {
              "mode": "graphql",
              "graphql": {
                "query": "mutation ResendOtp($input: ResendOtpInput!) {\n  resendOtp(input: $input)\n}",
                "variables": "{\n  \"input\": {\n    \"email\": \"{{testEmail}}\",\n    \"type\": \"EMAIL_VERIFICATION\"\n  }\n}"
              }
            },
            "url": {
              "raw": "{{graphqlEndpoint}}",
              "host": ["{{graphqlEndpoint}}"]
            },
            "description": "Tests both per-minute rate limit (3 requests) and the 1-minute wait between resends."
          },
          "response": []
        },
        {
          "name": "4. Test Password Reset Rate Limit (3/5min)",
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "var jsonData = pm.response.json();",
                  "",
                  "if (jsonData.errors) {",
                  "    if (iteration === 4) {",
                  "        pm.test('Password reset rate limit triggered', function() {",
                  "            pm.expect(jsonData.errors[0].message).to.include('Too many requests');",
                  "            pm.response.to.have.status(429);",
                  "        });",
                  "    }",
                  "}"
                ],
                "type": "text/javascript"
              }
            }
          ],
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "body": {
              "mode": "graphql",
              "graphql": {
                "query": "mutation RequestPasswordReset($input: RequestPasswordResetInput!) {\n  requestPasswordReset(input: $input)\n}",
                "variables": "{\n  \"input\": {\n    \"email\": \"{{testEmail}}\"\n  }\n}"
              }
            },
            "url": {
              "raw": "{{graphqlEndpoint}}",
              "host": ["{{graphqlEndpoint}}"]
            },
            "description": "Run 4 times quickly to trigger rate limit. 3 password reset requests allowed per 5 minutes."
          },
          "response": []
        },
        {
          "name": "5. Test Admin Endpoint No Throttle",
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "var jsonData = pm.response.json();",
                  "",
                  "if (jsonData.data) {",
                  "    pm.test('Admin endpoints skip throttling', function() {",
                  "        pm.response.to.have.status(200);",
                  "        pm.expect(jsonData.data.users).to.be.an('object');",
                  "    });",
                  "}"
                ],
                "type": "text/javascript"
              }
            }
          ],
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              },
              {
                "key": "Authorization",
                "value": "Bearer {{token}}"
              }
            ],
            "body": {
              "mode": "graphql",
              "graphql": {
                "query": "query GetUsers($filters: UsersFilterInput) {\n  users(filters: $filters) {\n    users {\n      _id\n      email\n    }\n    total\n  }\n}",
                "variables": "{\n  \"filters\": {\n    \"page\": 1,\n    \"limit\": 5\n  }\n}"
              }
            },
            "url": {
              "raw": "{{graphqlEndpoint}}",
              "host": ["{{graphqlEndpoint}}"]
            },
            "description": "Admin queries skip rate limiting (SkipThrottle decorator). Run multiple times to verify."
          },
          "response": []
        }
      ],
      "description": "Test rate limiting on various endpoints. Verify throttling behavior and admin bypass."
    },
    {
      "name": "üß™ Testing - OAuth Flows",
      "item": [
        {
          "name": "1. GitHub OAuth - Check User-Agent Header",
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "// Verify GitHub OAuth includes required User-Agent header",
                  "pm.test('User-Agent header present in request', function() {",
                  "    const requestHeaders = pm.request.headers.all();",
                  "    const userAgentHeader = requestHeaders.find(h => h.key.toLowerCase() === 'user-agent');",
                  "    pm.expect(userAgentHeader).to.be.undefined; // Browser will handle this",
                  "});",
                  "",
                  "console.log('‚úì GitHub OAuth flow initiated with proper User-Agent');"
                ],
                "type": "text/javascript"
              }
            }
          ],
          "request": {
            "method": "GET",
            "header": [
              {
                "key": "User-Agent",
                "value": "nest-e-commerce-app",
                "type": "text"
              }
            ],
            "url": {
              "raw": "{{baseUrl}}/auth/github",
              "host": ["{{baseUrl}}"],
              "path": ["auth", "github"]
            },
            "description": "Tests that GitHub OAuth includes mandatory User-Agent header (GitHub API requirement since 2014)."
          },
          "response": []
        },
        {
          "name": "2. Verify OAuth Account Linking",
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "// Test OAuth account linking behavior",
                  "pm.test('OAuth test callback returns tokens', function() {",
                  "    pm.response.to.have.status(200);",
                  "});",
                  "",
                  "var jsonData = pm.response.json();",
                  "if (jsonData.success) {",
                  "    console.log('‚úì OAuth account linked/created successfully');",
                  "    console.log('‚úì Tokens generated for OAuth user');",
                  "    ",
                  "    pm.test('OAuth response includes user and tokens', function() {",
                  "        pm.expect(jsonData.user).to.be.an('object');",
                  "        pm.expect(jsonData.tokens.accessToken).to.be.a('string');",
                  "        pm.expect(jsonData.tokens.refreshToken).to.be.a('string');",
                  "    });",
                  "}"
                ],
                "type": "text/javascript"
              }
            }
          ],
          "request": {
            "method": "GET",
            "header": [],
            "url": {
              "raw": "{{baseUrl}}/auth/google/callback/test",
              "host": ["{{baseUrl}}"],
              "path": ["auth", "google", "callback", "test"]
            },
            "description": "Tests OAuth account linking flow. If user with email exists, links OAuth ID; otherwise creates new user."
          },
          "response": []
        }
      ],
      "description": "Test OAuth-specific behaviors and edge cases"
    },
    {
      "name": "üß™ Testing - Queue Processing",
      "item": [
        {
          "name": "1. Verify File Processing Queue",
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "var jsonData = pm.response.json();",
                  "",
                  "if (jsonData.data && jsonData.data.file) {",
                  "    var file = jsonData.data.file;",
                  "    console.log('‚úì File status:', file.status);",
                  "    ",
                  "    pm.test('File processing completed', function() {",
                  "        // Status should progress from PENDING -> PROCESSING -> COMPLETED",
                  "        pm.expect(file.status).to.be.oneOf(['PENDING', 'PROCESSING', 'COMPLETED']);",
                  "        if (file.status === 'COMPLETED') {",
                  "            pm.expect(file.optimizedUrl).to.be.a('string');",
                  "            pm.expect(file.variants).tb",
                  "be.an('array');",
                  "        }",
                  "    });",
                  "}"
                ],
                "type": "text/javascript"
              }
            }
          ],
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              },
              {
                "key": "Authorization",
                "value": "Bearer {{token}}"
              }
            ],
            "body": {
              "mode": "graphql",
              "graphql": {
                "query": "query GetFile($id: ID!) {\n  file(id: $id) {\n    _id\n    status\n    optimizedUrl\n    variants\n    metadata {\n      width\n      height\n    }\n  }\n}",
                "variables": "{\n  \"id\": \"{{fileId}}\"\n}"
              }
            },
            "url": {
              "raw": "{{graphqlEndpoint}}",
              "host": ["{{graphqlEndpoint}}"]
            },
            "description": "Poll file status to verify async processing. After upload, file should be processed by queue worker."
          },
          "response": []
        },
        {
          "name": "2. Check Bull Board Access",
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "pm.test('Bull Board accessible', function() {",
                  "    pm.response.to.have.status(200);",
                  "});",
                  "",
                  "console.log('‚úì Bull Board dashboard is accessible');",
                  "console.log('‚úì Queue monitoring active');"
                ],
                "type": "text/javascript"
              }
            }
          ],
          "request": {
            "method": "GET",
            "header": [
              {
                "key": "Authorization",
                "value": "Basic YWRtajpjaGFuZ2UtdGhpcy1wYXNzd29yZA=="
              }
            ],
            "url": {
              "raw": "{{baseUrl}}/admin/queues",
              "host": ["{{baseUrl}}"],
              "path": ["admin", "queues"]
            },
            "description": "Verify Bull Board is accessible for queue monitoring. Check both email and storage queues."
          },
          "response": []
        }
      ],
      "description": "Test background job processing and queue functionality"
    },
    {
      "name": "‚ù§Ô∏è Health Checks",
      "item": [
        {
          "name": "1. GraphQL Health Check",
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "pm.test('GraphQL endpoint is healthy', function() {",
                  "    pm.response.to.have.status(200);",
                  "});",
                  "",
                  "var jsonData = pm.response.json();",
                  "if (jsonData.data) {",
                  "    console.log('‚úì GraphQL schema is accessible');",
                  "}"
                ],
                "type": "text/javascript"
              }
            }
          ],
          "request": {
            "method": "GET",
            "header": [],
            "url": {
              "raw": "{{baseUrl}}/graphql",
              "host": ["{{baseUrl}}"],
              "path": ["graphql"]
            },
            "description": "Basic health check for GraphQL endpoint. Should return 200 even without authentication."
          },
          "response": []
        },
        {
          "name": "2. MongoDB Connection Check",
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "var jsonData = pm.response.json();",
                  "",
                  "if (jsonData.data && jsonData.data.users) {",
                  "    pm.test('MongoDB connection healthy', function() {",
                  "        pm.expect(jsonData.data.users.users).to.be.an('array');",
                  "        console.log('‚úì MongoDB query executed successfully');",
                  "    });",
                  "}"
                ],
                "type": "text/javascript"
              }
            }
          ],
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              },
              {
                "key": "Authorization",
                "value": "Bearer {{token}}"
              }
            ],
            "body": {
              "mode": "graphql",
              "graphql": {
                "query": "query HealthCheck {\n  users(filters: {limit: 1}) {\n    users {\n      _id\n    }\n    total\n  }\n}",
                "variables": ""
              }
            },
            "url": {
              "raw": "{{graphqlEndpoint}}",
              "host": ["{{graphqlEndpoint}}"]
            },
            "description": "Verify MongoDB connection via GraphQL query. Tests database connectivity."
          },
          "response": []
        },
        {
          "name": "3. Redis Connection Check",
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "var jsonData = pm.response.json();",
                  "",
                  "if (jsonData.data && jsonData.data.login) {",
                  "    pm.test('Redis connection healthy (rate limiting)', function() {",
                  "        console.log('‚úì Redis rate limiting active');",
                  "    });",
                  "}",
                  "",
                  "if (jsonData.errors && jsonData.errors[0].extensions.code === 'TOO_MANY_REQUESTS') {",
                  "    pm.test('Redis rate limiting working', function() {",
                  "        console.log('‚úì Redis rate limiting functional');",
                  "    });",
                  "}"
                ],
                "type": "text/javascript"
              }
            }
          ],
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "body": {
              "mode": "graphql",
              "graphql": {
                "query": "mutation RedisCheck($input: LoginInput!) {\n  login(input: $input) {\n    accessToken\n  }\n}",
                "variables": "{\n  \"input\": {\n    \"email\": \"{{testEmail}}\",\n    \"password\": \"wrong\"\n  }\n}"
              }
            },
            "url": {
              "raw": "{{graphqlEndpoint}}",
              "host": ["{{graphqlEndpoint}}"]
            },
            "description": "Verify Redis connection via rate limiting. If Redis is down, rate limiting will fail open."
          },
          "response": []
        }
      ],
      "description": "Health check endpoints for monitoring service status"
    }
  ],
  "event": [
    {
      "listen": "prerequest",
      "script": {
        "type": "text/javascript",
        "exec": [
          "// Set timestamp header for request signing if needed",
          "// pm.request.headers.add({key: 'X-Timestamp', value: Date.now().toString()});"
        ]
      }
    },
    {
      "listen": "test",
      "script": {
        "type": "text/javascript",
        "exec": [
          "// Global test hooks can go here",
          "// Log all responses for debugging",
          "// console.log('Response:', pm.response.json());"
        ]
      }
    }
  ],
  "variable": [
    {
      "key": "baseUrl",
      "value": "http://localhost:5000",
      "type": "string"
    },
    {
      "key": "graphqlEndpoint",
      "value": "http://localhost:5000/graphql",
      "type": "string"
    },
    {
      "key": "token",
      "value": "",
      "type": "string"
    },
    {
      "key": "refreshToken",
      "value": "",
      "type": "string"
    },
    {
      "key": "userId",
      "value": "",
      "type": "string"
    },
    {
      "key": "addressId",
      "value": "",
      "type": "string"
    },
    {
      "key": "fileId",
      "value": "",
      "type": "string"
    },
    {
      "key": "otpCode",
      "value": "",
      "type": "string"
    },
    {
      "key": "testEmail",
      "value": "test@example.com",
      "type": "string"
    },
    {
      "key": "testPassword",
      "value": "SecurePass123!",
      "type": "string"
    },
    {
      "key": "adminEmail",
      "value": "admin@example.com",
      "type": "string"
    },
    {
      "key": "jobId",
      "value": "",
      "type": "string"
    },
    {
      "key": "twoFactorSecret",
      "value": "",
      "type": "string"
    },
    {
      "key": "twoFactorToken",
      "value": "",
      "type": "string"
    },
    {
      "key": "tempToken",
      "value": "",
      "type": "string"
    },
    {
      "key": "backupCode",
      "value": "",
      "type": "string"
    },
    {
      "key": "backupCodes",
      "value": "",
      "type": "string"
    },
    {
      "key": "notificationId",
      "value": "",
      "type": "string"
    },
    {
      "key": "adminNotificationId",
      "value": "",
      "type": "string"
    }
  ]
}
